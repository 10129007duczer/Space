{"version":3,"file":"scramjet.client.js","sources":["webpack://@mercuryworkshop/scramjet/./src/client/client.ts","webpack://@mercuryworkshop/scramjet/./src/client/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/attr.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/cookie.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/css.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/element.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/fontface.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/history.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/navigation.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/open.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/origin.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/performance.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/serviceworker.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/storage.ts","webpack://@mercuryworkshop/scramjet/./src/client/events.ts","webpack://@mercuryworkshop/scramjet/./src/client/global.ts","webpack://@mercuryworkshop/scramjet/./src/client/helpers.ts","webpack://@mercuryworkshop/scramjet/./src/client/index.ts","webpack://@mercuryworkshop/scramjet/./src/client/location.ts","webpack://@mercuryworkshop/scramjet/./src/client/natives.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/antiantidebugger.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/blob.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/err.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/error.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/eval.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/event.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/function.ts","webpack://@mercuryworkshop/scramjet/./rewriter/out/rewriter.js","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/js.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/import.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/url.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/indexeddb.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/postmessage.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/realm.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/beacon.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/eventsource.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/fetch.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/websocket.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/xmlhttprequest.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/sourcemaps.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/trustedTypes.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/unproxy.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/worker.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/wrap.ts","webpack://@mercuryworkshop/scramjet/./src/client/swruntime.ts","webpack://@mercuryworkshop/scramjet/./src/client/worker/importScripts.ts","webpack://@mercuryworkshop/scramjet/./src/log.ts","webpack://@mercuryworkshop/scramjet/./src/scramjet.ts","webpack://@mercuryworkshop/scramjet/./src/shared.ts","webpack://@mercuryworkshop/scramjet/./src/symbols.ts"],"sourcesContent":["import { iswindow } from \".\";\nimport { ScramjetFrame } from \"../controller/frame\";\nimport { SCRAMJETCLIENT, SCRAMJETFRAME } from \"../symbols\";\nimport { createDocumentProxy } from \"./document\";\nimport { createGlobalProxy } from \"./global\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\nimport { createLocationProxy } from \"./location\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport {\n\tBareClient,\n\tCookieStore,\n\tconfig,\n\tunrewriteUrl,\n\trewriteUrl,\n} from \"../shared\";\nimport { BareClient as BareClientType } from \"@mercuryworkshop/bare-mux\";\nimport { createWrapFn } from \"./shared/wrap\";\nimport { NavigateEvent } from \"./events\";\nimport type { URLMeta } from \"../shared/rewriters/url\";\n\ndeclare global {\n\tinterface Window {\n\t\t$s: any;\n\t\t$tryset: any;\n\t\t$sImport: any;\n\t}\n}\n\n//eslint-disable-next-line\nexport type AnyFunction = Function;\n\nexport type ProxyCtx = {\n\tfn: AnyFunction;\n\tthis: any;\n\targs: any[];\n\tnewTarget: AnyFunction;\n\treturn: (r: any) => void;\n\tcall: () => any;\n};\nexport type Proxy = {\n\tconstruct?(ctx: ProxyCtx): any;\n\tapply?(ctx: ProxyCtx): any;\n};\n\nexport type TrapCtx<T> = {\n\tthis: any;\n\tget: () => T;\n\tset: (v: T) => void;\n};\nexport type Trap<T> = {\n\twritable?: boolean;\n\tvalue?: any;\n\tenumerable?: boolean;\n\tconfigurable?: boolean;\n\tget?: (ctx: TrapCtx<T>) => T;\n\tset?: (ctx: TrapCtx<T>, v: T) => void;\n};\n\nexport class ScramjetClient {\n\tdocumentProxy: any;\n\tglobalProxy: any;\n\tlocationProxy: any;\n\tserviceWorker: ServiceWorkerContainer;\n\tbare: BareClientType;\n\n\tdescriptors: Record<string, PropertyDescriptor> = {};\n\tnatives: Record<string, any> = {};\n\twrapfn: (i: any, ...args: any) => any;\n\n\tcookieStore = new CookieStore();\n\n\teventcallbacks: Map<\n\t\tany,\n\t\t[\n\t\t\t{\n\t\t\t\tevent: string;\n\t\t\t\toriginalCallback: AnyFunction;\n\t\t\t\tproxiedCallback: AnyFunction;\n\t\t\t},\n\t\t]\n\t> = new Map();\n\n\tmeta: URLMeta;\n\n\tconstructor(public global: typeof globalThis) {\n\t\tthis.serviceWorker = this.global.navigator.serviceWorker;\n\n\t\tif (iswindow) {\n\t\t\tthis.documentProxy = createDocumentProxy(this, global);\n\n\t\t\tglobal.document[SCRAMJETCLIENT] = this;\n\t\t}\n\n\t\tthis.locationProxy = createLocationProxy(this, global);\n\t\tthis.globalProxy = createGlobalProxy(this, global);\n\t\tthis.wrapfn = createWrapFn(this, global);\n\t\tif (iswindow) {\n\t\t\tthis.bare = new BareClient();\n\t\t} else {\n\t\t\tthis.bare = new BareClient(\n\t\t\t\tnew Promise((resolve) => {\n\t\t\t\t\taddEventListener(\"message\", ({ data }) => {\n\t\t\t\t\t\tif (typeof data !== \"object\") return;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\"$scramjet$type\" in data &&\n\t\t\t\t\t\t\tdata.$scramjet$type === \"baremuxinit\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresolve(data.port);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst client = this;\n\t\tthis.meta = {\n\t\t\tget origin() {\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t\tget base() {\n\t\t\t\tif (iswindow) {\n\t\t\t\t\tconst base = client.global.document.querySelector(\"base\");\n\t\t\t\t\tif (base) {\n\t\t\t\t\t\tlet url = base.getAttribute(\"href\");\n\t\t\t\t\t\tconst frag = url.indexOf(\"#\");\n\t\t\t\t\t\turl = url.substring(0, frag === -1 ? undefined : frag);\n\t\t\t\t\t\tif (!url) return client.url;\n\n\t\t\t\t\t\treturn new URL(url, client.url.origin);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t};\n\n\t\tglobal[SCRAMJETCLIENT] = this;\n\t}\n\n\tget frame(): ScramjetFrame | null {\n\t\tif (!iswindow) return null;\n\t\tconst frame = this.global.window.frameElement;\n\n\t\tif (!frame) return null; // we're top level\n\t\tconst sframe = frame[SCRAMJETFRAME];\n\n\t\tif (!sframe) {\n\t\t\t// we're in a subframe, recurse upward until we find one\n\t\t\tlet currentwin = this.global.window;\n\t\t\twhile (currentwin.parent != currentwin) {\n\t\t\t\tif (!currentwin.frameElement) return null; // ??\n\t\t\t\tif (currentwin.frameElement && currentwin.frameElement[SCRAMJETFRAME]) {\n\t\t\t\t\treturn currentwin.frameElement[SCRAMJETFRAME];\n\t\t\t\t}\n\t\t\t\tcurrentwin = currentwin.parent.window;\n\t\t\t}\n\t\t}\n\n\t\treturn sframe;\n\t}\n\n\tloadcookies(cookiestr: string) {\n\t\tthis.cookieStore.load(cookiestr);\n\t}\n\n\thook() {\n\t\t// @ts-ignore\n\t\tconst context = import.meta.webpackContext(\".\", {\n\t\t\trecursive: true,\n\t\t});\n\n\t\tconst modules = [];\n\n\t\tfor (const key of context.keys()) {\n\t\t\tconst module = context(key);\n\t\t\tif (!key.endsWith(\".ts\")) continue;\n\t\t\tif (\n\t\t\t\t(key.startsWith(\"./dom/\") && \"window\" in this.global) ||\n\t\t\t\t(key.startsWith(\"./worker/\") && \"WorkerGlobalScope\" in this.global) ||\n\t\t\t\tkey.startsWith(\"./shared/\")\n\t\t\t) {\n\t\t\t\tmodules.push(module);\n\t\t\t}\n\t\t}\n\n\t\tmodules.sort((a, b) => {\n\t\t\tconst aorder = a.order || 0;\n\t\t\tconst border = b.order || 0;\n\n\t\t\treturn aorder - border;\n\t\t});\n\n\t\tfor (const module of modules) {\n\t\t\tif (!module.enabled || module.enabled(this))\n\t\t\t\tmodule.default(this, this.global);\n\t\t\telse if (module.disabled) module.disabled(this, this.global);\n\t\t}\n\t}\n\n\tget url(): URL {\n\t\treturn new URL(unrewriteUrl(this.global.location.href));\n\t}\n\n\tset url(url: URL | string) {\n\t\tif (url instanceof URL) url = url.toString();\n\n\t\tconst ev = new NavigateEvent(url);\n\t\tif (this.frame) {\n\t\t\tthis.frame.dispatchEvent(ev);\n\t\t}\n\t\tif (ev.defaultPrevented) return;\n\n\t\tthis.global.location.href = rewriteUrl(ev.url, this.meta);\n\t}\n\n\t// below are the utilities for proxying and trapping dom APIs\n\t// you don't have to understand this it just makes the rest easier\n\t// i'll document it eventually\n\n\tProxy(name: string | string[], handler: Proxy) {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Proxy(n, handler);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\t\tconst original = Reflect.get(target, prop);\n\t\tthis.natives[name] = original;\n\n\t\tthis.RawProxy(target, prop, handler);\n\t}\n\tRawProxy(target: any, prop: string, handler: Proxy) {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst value = Reflect.get(target, prop);\n\t\tdelete target[prop];\n\n\t\tconst h: ProxyHandler<any> = {};\n\n\t\tif (handler.construct) {\n\t\t\th.construct = function (\n\t\t\t\tconstructor: any,\n\t\t\t\targArray: any[],\n\t\t\t\tnewTarget: AnyFunction\n\t\t\t) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn: constructor,\n\t\t\t\t\tthis: null,\n\t\t\t\t\targs: argArray,\n\t\t\t\t\tnewTarget: newTarget,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\thandler.construct(ctx);\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\t\t\t};\n\t\t}\n\n\t\tif (handler.apply) {\n\t\t\th.apply = function (fn: any, thisArg: any, argArray: any[]) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn,\n\t\t\t\t\tthis: thisArg,\n\t\t\t\t\targs: argArray,\n\t\t\t\t\tnewTarget: null,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst pst = Error.prepareStackTrace;\n\n\t\t\t\tError.prepareStackTrace = function (err, s) {\n\t\t\t\t\tif (\n\t\t\t\t\t\ts[0].getFileName() &&\n\t\t\t\t\t\t!s[0].getFileName().startsWith(location.origin + config.prefix)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn { stack: err.stack };\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\thandler.apply(ctx);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err instanceof Error) {\n\t\t\t\t\t\tif ((err.stack as any) instanceof Object) {\n\t\t\t\t\t\t\t//@ts-expect-error i'm not going to explain this\n\t\t\t\t\t\t\terr.stack = err.stack.stack;\n\t\t\t\t\t\t\tconsole.error(\"ERROR FROM SCRMAJET INTERNALS\", err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tError.prepareStackTrace = pst;\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\t\t\t};\n\t\t}\n\n\t\th.getOwnPropertyDescriptor = getOwnPropertyDescriptorHandler;\n\t\ttarget[prop] = new Proxy(value, h);\n\t}\n\tTrap<T>(name: string | string[], descriptor: Trap<T>): PropertyDescriptor {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Trap(n, descriptor);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\n\t\tconst original = nativeGetOwnPropertyDescriptor(target, prop);\n\t\tthis.descriptors[name] = original;\n\n\t\treturn this.RawTrap(target, prop, descriptor);\n\t}\n\tRawTrap<T>(\n\t\ttarget: any,\n\t\tprop: string,\n\t\tdescriptor: Trap<T>\n\t): PropertyDescriptor {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst oldDescriptor = nativeGetOwnPropertyDescriptor(target, prop);\n\n\t\tconst ctx: TrapCtx<T> = {\n\t\t\tthis: null,\n\t\t\tget: function () {\n\t\t\t\treturn oldDescriptor && oldDescriptor.get.call(this.this);\n\t\t\t},\n\t\t\tset: function (v: T) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\t\toldDescriptor && oldDescriptor.set.call(this.this, v);\n\t\t\t},\n\t\t};\n\n\t\tdelete target[prop];\n\n\t\tconst desc: PropertyDescriptor = {};\n\n\t\tif (descriptor.get) {\n\t\t\tdesc.get = function () {\n\t\t\t\tctx.this = this;\n\n\t\t\t\treturn descriptor.get(ctx);\n\t\t\t};\n\t\t} else if (oldDescriptor?.get) {\n\t\t\tdesc.get = oldDescriptor.get;\n\t\t}\n\n\t\tif (descriptor.set) {\n\t\t\tdesc.set = function (v: T) {\n\t\t\t\tctx.this = this;\n\n\t\t\t\tdescriptor.set(ctx, v);\n\t\t\t};\n\t\t} else if (oldDescriptor?.set) {\n\t\t\tdesc.set = oldDescriptor.set;\n\t\t}\n\n\t\tif (descriptor.enumerable) desc.enumerable = descriptor.enumerable;\n\t\telse if (oldDescriptor?.enumerable)\n\t\t\tdesc.enumerable = oldDescriptor.enumerable;\n\t\tif (descriptor.configurable) desc.configurable = descriptor.configurable;\n\t\telse if (oldDescriptor?.configurable)\n\t\t\tdesc.configurable = oldDescriptor.configurable;\n\n\t\tObject.defineProperty(target, prop, desc);\n\n\t\treturn oldDescriptor;\n\t}\n}\n","import { rewriteUrl } from \"../shared\";\nimport { ScramjetClient } from \"./client\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\n\nexport function createDocumentProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\treturn new Proxy(self.document, {\n\t\tget(target, prop) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\treturn client.locationProxy;\n\t\t\t}\n\n\t\t\tif (prop === \"defaultView\") {\n\t\t\t\treturn client.globalProxy;\n\t\t\t}\n\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\treturn value;\n\t\t},\n\t\tset(target, prop, newValue) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tlocation.href = rewriteUrl(newValue, client.meta);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, newValue);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.Trap(\"Element.prototype.attributes\", {\n\t\tget(ctx) {\n\t\t\tconst map = ctx.get() as NamedNodeMap;\n\t\t\tconst proxy = new Proxy(map, {\n\t\t\t\tget(target, prop, receiver) {\n\t\t\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\t\t\tif (prop === \"length\") {\n\t\t\t\t\t\treturn Object.keys(proxy).length;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop === \"getNamedItem\") {\n\t\t\t\t\t\treturn (name: string) => proxy[name];\n\t\t\t\t\t}\n\t\t\t\t\tif (prop === \"getNamedItemNS\") {\n\t\t\t\t\t\treturn (namespace: string, name: string) =>\n\t\t\t\t\t\t\tproxy[`${namespace}:${name}`];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop in NamedNodeMap.prototype && typeof value === \"function\") {\n\t\t\t\t\t\treturn new Proxy(value, {\n\t\t\t\t\t\t\tapply(target, thisArg, argArray) {\n\t\t\t\t\t\t\t\tif (thisArg === proxy) {\n\t\t\t\t\t\t\t\t\treturn Reflect.apply(target, map, argArray);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, thisArg, argArray);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.has(target, prop)) return undefined;\n\n\t\t\t\t\tif (value instanceof Attr) {\n\t\t\t\t\t\tlet attr = value;\n\t\t\t\t\t\treturn new Proxy(attr, {\n\t\t\t\t\t\t\tget(target, prop) {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tprop === \"value\" ||\n\t\t\t\t\t\t\t\t\tprop === \"nodeValue\" ||\n\t\t\t\t\t\t\t\t\tprop === \"textContent\"\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t// we're using the proxied getAttribute here\n\t\t\t\t\t\t\t\t\treturn target.ownerElement.getAttribute(target.name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tset(target, prop, value) {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tprop === \"value\" ||\n\t\t\t\t\t\t\t\t\tprop === \"nodeValue\" ||\n\t\t\t\t\t\t\t\t\tprop === \"textContent\"\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\ttarget.ownerElement.setAttribute(target.name, value);\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn Reflect.set(target, prop, value);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\townKeys(target) {\n\t\t\t\t\tconst keys = Reflect.ownKeys(target);\n\t\t\t\t\treturn keys.filter((key) => this.has(target, key));\n\t\t\t\t},\n\t\t\t\thas(target, prop) {\n\t\t\t\t\tif (typeof prop === \"symbol\") return Reflect.has(target, prop);\n\t\t\t\t\tif (prop.startsWith(\"data-scramjet-\")) return false;\n\t\t\t\t\tif (map[prop]?.name?.startsWith(\"data-scramjet-\")) return false;\n\t\t\t\t\treturn Reflect.has(target, prop);\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn proxy;\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.serviceWorker.addEventListener(\"message\", ({ data }) => {\n\t\tif (!(\"scramjet$type\" in data)) return;\n\n\t\tif (data.scramjet$type === \"cookie\") {\n\t\t\tclient.cookieStore.setCookies([data.cookie], new URL(data.url));\n\t\t}\n\t});\n\n\tclient.Trap(\"Document.prototype.cookie\", {\n\t\tget() {\n\t\t\treturn client.cookieStore.getCookies(client.url, true);\n\t\t},\n\t\tset(ctx, value: string) {\n\t\t\tclient.cookieStore.setCookies([value], client.url);\n\n\t\t\tif (client.serviceWorker.controller) {\n\t\t\t\tclient.serviceWorker.controller!.postMessage({\n\t\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\t\tcookie: value,\n\t\t\t\t\turl: client.url.href,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n\n\t// @ts-ignore\n\tdelete self.cookieStore;\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss, unrewriteCss } from \"../../shared\";\n\nconst cssProperties = [\n\t\"background\",\n\t\"background-image\",\n\t\"mask\",\n\t\"mask-image\",\n\t\"list-style\",\n\t\"list-style-image\",\n\t\"border-image\",\n\t\"border-image-source\",\n\t\"cursor\",\n];\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.setProperty\", {\n\t\tapply(ctx) {\n\t\t\tif (cssProperties.includes(ctx.args[0]))\n\t\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.getPropertyValue\", {\n\t\tapply(ctx) {\n\t\t\tif (cssProperties.includes(ctx.args[0])) {\n\t\t\t\tconst realProperty = ctx.call();\n\n\t\t\t\treturn ctx.return(unrewriteCss(realProperty));\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"CSSStyleDeclaration.prototype.cssText\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteCss(value, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteCss(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"HTMLElement.prototype.style\", {\n\t\tget(ctx) {\n\t\t\t// unfortunate and dumb hack. we have to trap every property of this\n\t\t\t// since the prototype chain is fucked\n\n\t\t\tconst style = ctx.get() as CSSStyleDeclaration;\n\n\t\t\treturn new Proxy(style, {\n\t\t\t\tget(t, p) {\n\t\t\t\t\tconst v = Reflect.get(t, p);\n\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\treturn new Proxy(v, {\n\t\t\t\t\t\t\tapply(target, thisArg, argArray) {\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, style, argArray);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn unrewriteCss(v);\n\t\t\t\t},\n\t\t\t\tset(t, p, v) {\n\t\t\t\t\tif (p == \"cssText\" || v == \"\" || typeof v !== \"string\") {\n\t\t\t\t\t\treturn Reflect.set(t, p, v);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(t, p, rewriteCss(v, client.meta));\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tset(ctx, v: string) {\n\t\t\t// this will actually run the trap for cssText. don't rewrite it here\n\t\t\tctx.set(v);\n\t\t},\n\t});\n}\n","import { rewriteHtml } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.Proxy(\"Document.prototype.write\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\tctx.args[0],\n\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\tclient.meta,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.writeln\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\tctx.args[0],\n\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\tclient.meta,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t},\n\t});\n}\n","import { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport {\n\tunrewriteUrl,\n\thtmlRules,\n\tunrewriteHtml,\n\tunrewriteBlob,\n} from \"../../shared\";\nimport {\n\trewriteUrl,\n\trewriteCss,\n\trewriteHtml,\n\trewriteJs,\n\trewriteSrcset,\n} from \"../../shared\";\nimport type { URLMeta } from \"../../shared/rewriters/url\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst _nativeGetAttribute = self.Element.prototype.getAttribute;\n\tconst nativeSetAttribute = self.Element.prototype.setAttribute;\n\tconst _nativeHasAttribute = self.Element.prototype.hasAttribute;\n\n\tconst attrObject = {\n\t\tnonce: [self.HTMLElement],\n\t\tintegrity: [self.HTMLScriptElement, self.HTMLLinkElement],\n\t\tcsp: [self.HTMLIFrameElement],\n\t\tsrc: [\n\t\t\tself.HTMLImageElement,\n\t\t\tself.HTMLMediaElement,\n\t\t\tself.HTMLIFrameElement,\n\t\t\tself.HTMLEmbedElement,\n\t\t\tself.HTMLScriptElement,\n\t\t\tself.HTMLSourceElement,\n\t\t],\n\t\thref: [self.HTMLAnchorElement, self.HTMLLinkElement],\n\t\tdata: [self.HTMLObjectElement],\n\t\taction: [self.HTMLFormElement],\n\t\tformaction: [self.HTMLButtonElement, self.HTMLInputElement],\n\t\tsrcdoc: [self.HTMLIFrameElement],\n\t\tsrcset: [self.HTMLImageElement, self.HTMLSourceElement],\n\t\timagesrcset: [self.HTMLLinkElement],\n\t};\n\n\tconst urlinterfaces = [\n\t\tself.HTMLAnchorElement.prototype,\n\t\tself.HTMLAreaElement.prototype,\n\t];\n\tconst originalhrefs = [\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAnchorElement.prototype, \"href\"),\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAreaElement.prototype, \"href\"),\n\t];\n\n\tconst attrs = Object.keys(attrObject);\n\n\tfor (const attr of attrs) {\n\t\tfor (const element of attrObject[attr]) {\n\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(\n\t\t\t\telement.prototype,\n\t\t\t\tattr\n\t\t\t);\n\t\t\tObject.defineProperty(element.prototype, attr, {\n\t\t\t\tget() {\n\t\t\t\t\tif ([\"src\", \"data\", \"href\", \"action\", \"formaction\"].includes(attr)) {\n\t\t\t\t\t\treturn unrewriteUrl(descriptor.get.call(this));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn descriptor.get.call(this);\n\t\t\t\t},\n\n\t\t\t\tset(value) {\n\t\t\t\t\tnativeSetAttribute.call(this, \"data-scramjet-\" + attr, value);\n\t\t\t\t\tif ([\"nonce\", \"integrity\", \"csp\"].includes(attr)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t[\"src\", \"data\", \"href\", \"action\", \"formaction\"].includes(attr)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (element === HTMLMediaElement && value.startsWith(\"blob:\")) {\n\t\t\t\t\t\t\t// mediasource blobs cannot be handled in the service worker and must be sourced here\n\t\t\t\t\t\t\tvalue = unrewriteBlob(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvalue = rewriteUrl(value, client.meta);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (attr === \"srcdoc\") {\n\t\t\t\t\t\tvalue = rewriteHtml(\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t// srcdoc preserves parent origin i think\n\t\t\t\t\t\t\t\tbase: new URL(client.url.origin),\n\t\t\t\t\t\t\t\torigin: new URL(client.url.origin),\n\t\t\t\t\t\t\t} as URLMeta,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if ([\"srcset\", \"imagesrcset\"].includes(attr)) {\n\t\t\t\t\t\tvalue = rewriteSrcset(value, client.meta);\n\t\t\t\t\t}\n\n\t\t\t\t\tdescriptor.set.call(this, value);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t// note that href is not here\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tfor (const i in urlinterfaces) {\n\t\t\tconst target = urlinterfaces[i];\n\t\t\tconst desc = originalhrefs[i];\n\t\t\tclient.RawTrap(target, prop, {\n\t\t\t\tget(ctx) {\n\t\t\t\t\tconst href = desc.get.call(ctx.this);\n\t\t\t\t\tif (!href) return href;\n\n\t\t\t\t\tconst url = new URL(unrewriteUrl(href));\n\n\t\t\t\t\treturn url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tclient.Trap(\"Node.prototype.baseURI\", {\n\t\tget() {\n\t\t\t// TODO this should be using ownerdocument but who gaf\n\t\t\tconst base = self.document.querySelector(\"base\");\n\t\t\tif (base) {\n\t\t\t\treturn new URL(base.href, client.url.origin).href;\n\t\t\t}\n\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[1] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tctx.fn.call(ctx.this, `data-scramjet-${ctx.args[0]}`, value);\n\t\t\t}\n\t\t},\n\t});\n\tclient.Proxy(\"Element.prototype.setAttributeNS\", {\n\t\tapply(ctx) {\n\t\t\tconst [namespace, name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[2] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tnativeSetAttribute.call(\n\t\t\t\t\tctx.this,\n\t\t\t\t\t`data-scramjet-${ctx.args[1]}`,\n\t\t\t\t\tvalue\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name] = ctx.args;\n\n\t\t\tif (ctx.fn.call(ctx.this, `data-scramjet-${name}`)) {\n\t\t\t\tctx.return(ctx.fn.call(ctx.this, `data-scramjet-${name}`));\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.innerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tlet newval;\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\tnewval = rewriteJs(value, client.meta);\n\t\t\t} else if (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\tnewval = rewriteCss(value, client.meta);\n\t\t\t} else {\n\t\t\t\tnewval = rewriteHtml(value, client.cookieStore, client.meta);\n\t\t\t}\n\n\t\t\tctx.set(newval);\n\t\t},\n\t\tget(ctx) {\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\treturn atob(\n\t\t\t\t\tclient.natives[\"Element.prototype.getAttribute\"].call(\n\t\t\t\t\t\tctx.this,\n\t\t\t\t\t\t\"data-scramjet-script-source-src\"\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\treturn ctx.get();\n\t\t\t}\n\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.outerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteHtml(value, client.cookieStore, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"HTMLIFrameElement.prototype.contentWindow\", {\n\t\tget(ctx) {\n\t\t\tconst realwin = ctx.get() as Window;\n\t\t\tif (!realwin) return realwin;\n\n\t\t\tif (SCRAMJETCLIENT in realwin.self) {\n\t\t\t\tif (realwin.location.href.includes(\"accounts.google.com\")) return null; // don't question it\n\n\t\t\t\treturn realwin.self[SCRAMJETCLIENT].globalProxy;\n\t\t\t} else {\n\t\t\t\t// hook the iframe\n\t\t\t\tconst newclient = new ScramjetClient(realwin.self);\n\t\t\t\tnewclient.hook();\n\n\t\t\t\treturn newclient.globalProxy;\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"HTMLIFrameElement.prototype.contentDocument\", {\n\t\tget(ctx) {\n\t\t\tconst contentwindow =\n\t\t\t\tclient.descriptors[\"HTMLIFrameElement.prototype.contentWindow\"].get;\n\t\t\tconst realwin = contentwindow.apply(ctx.this);\n\t\t\tif (!realwin) return realwin;\n\n\t\t\tif (SCRAMJETCLIENT in realwin.self) {\n\t\t\t\treturn realwin.self[SCRAMJETCLIENT].documentProxy;\n\t\t\t} else {\n\t\t\t\tconst newclient = new ScramjetClient(realwin.self);\n\t\t\t\tnewclient.hook();\n\n\t\t\t\treturn newclient.documentProxy;\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"TreeWalker.prototype.currentNode\", {\n\t\tget(ctx) {\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, value) {\n\t\t\tif (value == client.documentProxy) {\n\t\t\t\treturn ctx.set(self.document);\n\t\t\t}\n\n\t\t\treturn ctx.set(value);\n\t\t},\n\t});\n\n\tclient.Trap(\"Node.prototype.ownerDocument\", {\n\t\tget(ctx) {\n\t\t\t// return client.documentProxy;\n\t\t\tconst doc = ctx.get() as Document | null;\n\t\t\tif (!doc) return null;\n\n\t\t\tconst scram: ScramjetClient = doc[SCRAMJETCLIENT];\n\t\t\tif (!scram) return doc; // ??\n\n\t\t\treturn scram.documentProxy;\n\t\t},\n\t});\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"Node.prototype.parentNode\",\n\t\t\t\"Node.prototype.parentElement\",\n\t\t\t\"Node.prototype.previousSibling\",\n\t\t\t\"Node.prototype.nextSibling\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst n = ctx.get() as Node;\n\t\t\t\tif (!(n instanceof Document)) return n;\n\n\t\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\t\tif (!scram) return n; // ??\n\n\t\t\t\treturn scram.documentProxy;\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Proxy(\"Node.prototype.getRootNode\", {\n\t\tapply(ctx) {\n\t\t\tconst n = ctx.call() as Node;\n\t\t\tif (!(n instanceof Document)) return ctx.return(n);\n\n\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\tif (!scram) return ctx.return(n); // ??\n\n\t\t\treturn ctx.return(scram.documentProxy);\n\t\t},\n\t});\n\n\tclient.Proxy(\"DOMParser.prototype.parseFromString\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1] === \"text/html\") {\n\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\tctx.args[0],\n\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\tclient.meta,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss } from \"../../shared\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"FontFace\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteUrl } from \"../../shared\";\nimport { UrlChangeEvent } from \"../events\";\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tclient.Proxy(\"history.pushState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2]) ctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (client.frame) client.frame.dispatchEvent(ev);\n\t\t},\n\t});\n\n\tclient.Proxy(\"history.replaceState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2]) ctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (client.frame) client.frame.dispatchEvent(ev);\n\t\t},\n\t});\n}\n","export default function (client, self: Self) {\n\tdelete self.navigation;\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"window.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0]) ctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\tif ([\"_parent\", \"_top\", \"_unfencedTop\"].includes(ctx.args[1]))\n\t\t\t\tctx.args[1] = \"_self\";\n\n\t\t\tconst realwin = ctx.call();\n\n\t\t\tif (!realwin) return ctx.return(realwin);\n\n\t\t\tif (SCRAMJETCLIENT in realwin.self) {\n\t\t\t\treturn ctx.return(realwin.self[SCRAMJETCLIENT].globalProxy.window);\n\t\t\t} else {\n\t\t\t\tconst newclient = new ScramjetClient(realwin.self);\n\t\t\t\t// hook the opened window\n\t\t\t\tnewclient.hook();\n\n\t\t\t\treturn ctx.return(newclient.globalProxy);\n\t\t\t}\n\t\t},\n\t});\n\n\t// opener will refer to the real window if it was opened by window.open\n\tclient.Trap(\"opener\", {\n\t\tget(ctx) {\n\t\t\tconst realwin = ctx.get() as Window;\n\n\t\t\tif (realwin && SCRAMJETCLIENT in realwin.self) {\n\t\t\t\treturn realwin.self[SCRAMJETCLIENT].globalProxy;\n\t\t\t} else {\n\t\t\t\t// the opener has to have been already hooked, so if we reach here then it's a real window\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"window.frameElement\", {\n\t\tget(ctx) {\n\t\t\tconst f = ctx.get() as HTMLIFrameElement | null;\n\t\t\tif (!f) return f;\n\n\t\t\tconst win = f.ownerDocument.defaultView;\n\t\t\tif (win[SCRAMJETCLIENT]) {\n\t\t\t\t// then this is a subframe in a scramjet context, and it's safe to pass back the real iframe\n\t\t\t\treturn f;\n\t\t\t} else {\n\t\t\t\t// no, the top frame is outside the sandbox\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { unrewriteUrl } from \"../../shared\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.Trap(\"origin\", {\n\t\tget() {\n\t\t\t// this isn't right!!\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"document.URL\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"document.documentURI\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"document.domain\", {\n\t\tget() {\n\t\t\treturn client.url.hostname;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n}\n","import { unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tclient.Trap(\"PerformanceEntry.prototype.name\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { config, rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { type MessageC2W } from \"../../worker\";\nimport { getOwnPropertyDescriptorHandler } from \"../helpers\";\nimport { flagEnabled } from \"../../scramjet\";\n\n// we need a late order because we're mangling with addEventListener at a higher level\nexport const order = 2;\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"serviceworkers\", client.url);\n\nexport function disabled(_client: ScramjetClient, _self: Self) {\n\tReflect.deleteProperty(Navigator.prototype, \"serviceWorker\");\n}\nlet realPostMessage;\nif (self.ServiceWorker) {\n\trealPostMessage = ServiceWorker.prototype.postMessage;\n}\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tlet registration;\n\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registration === ctx.this) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registration === ctx.this) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"navigator.serviceWorker.getRegistration\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve(registration)));\n\t\t},\n\t});\n\n\tclient.Proxy(\"navigator.serviceWorker.getRegistrations\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve([registration])));\n\t\t},\n\t});\n\n\tclient.Trap(\"navigator.serviceWorker.ready\", {\n\t\tget(_ctx) {\n\t\t\tconsole.log(registration);\n\n\t\t\treturn new Promise((resolve) => resolve(registration));\n\t\t},\n\t});\n\n\tclient.Proxy(\"navigator.serviceWorker.register\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0] instanceof URL) ctx.args[0] = ctx.args[0].href;\n\t\t\tlet url = rewriteUrl(ctx.args[0], client.meta) + \"?dest=serviceworker\";\n\t\t\tif (ctx.args[1] && ctx.args[1].type === \"module\") {\n\t\t\t\turl += \"&type=module\";\n\t\t\t}\n\n\t\t\tconst nativeSharedWorker = client.natives[\"SharedWorker\"];\n\t\t\tconst worker = new nativeSharedWorker(url);\n\n\t\t\tconst handle = worker.port;\n\n\t\t\trealPostMessage.call(\n\t\t\t\tclient.serviceWorker.controller,\n\t\t\t\t{\n\t\t\t\t\tscramjet$type: \"registerServiceWorker\",\n\t\t\t\t\tport: handle,\n\t\t\t\t\torigin: client.url.origin,\n\t\t\t\t} as MessageC2W,\n\t\t\t\t[handle]\n\t\t\t);\n\n\t\t\tconst fakeRegistration = new Proxy(\n\t\t\t\t{\n\t\t\t\t\t__proto__: ServiceWorkerRegistration.prototype,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tget(target, prop) {\n\t\t\t\t\t\tif (prop === \"installing\") {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (prop === \"waiting\") {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (prop === \"active\") {\n\t\t\t\t\t\t\treturn handle;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (prop === \"scope\") {\n\t\t\t\t\t\t\treturn ctx.args[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (prop === \"unregister\") {\n\t\t\t\t\t\t\treturn () => {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (prop === \"addEventListener\") {\n\t\t\t\t\t\t\treturn () => {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t},\n\t\t\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t\t\t}\n\t\t\t);\n\t\t\tregistration = fakeRegistration;\n\n\t\t\tctx.return(new Promise((resolve) => resolve(fakeRegistration)));\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst handler: ProxyHandler<Storage> = {\n\t\tget(target, prop) {\n\t\t\tswitch (prop) {\n\t\t\t\tcase \"getItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"setItem\":\n\t\t\t\t\treturn (key: string, value: string) => {\n\t\t\t\t\t\treturn target.setItem(client.url.host + \"@\" + key, value);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"removeItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.removeItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"clear\":\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tfor (const key in Object.keys(target)) {\n\t\t\t\t\t\t\tif (key.startsWith(client.url.host)) {\n\t\t\t\t\t\t\t\ttarget.removeItem(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tcase \"key\":\n\t\t\t\t\treturn (index: number) => {\n\t\t\t\t\t\tconst keys = Object.keys(target).filter((key) =>\n\t\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn target.getItem(keys[index]);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"length\":\n\t\t\t\t\treturn Object.keys(target).filter((key) =>\n\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t).length;\n\n\t\t\t\tdefault:\n\t\t\t\t\tif (prop in Object.prototype || typeof prop === \"symbol\") {\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"GET\", prop, target == realLocalStorage);\n\n\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + (prop as string));\n\t\t\t}\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (target == realLocalStorage)\n\t\t\t\tconsole.log(\"SET\", prop, value, target === realLocalStorage);\n\t\t\ttarget.setItem(client.url.host + \"@\" + (prop as string), value);\n\n\t\t\treturn true;\n\t\t},\n\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target)\n\t\t\t\t.filter((f) => typeof f === \"string\" && f.startsWith(client.url.host))\n\t\t\t\t.map((f) =>\n\t\t\t\t\ttypeof f === \"string\" ? f.substring(client.url.host.length + 1) : f\n\t\t\t\t);\n\t\t},\n\n\t\tgetOwnPropertyDescriptor(target, property) {\n\t\t\treturn {\n\t\t\t\tvalue: target.getItem(client.url.host + \"@\" + (property as string)),\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true,\n\t\t\t};\n\t\t},\n\n\t\tdefineProperty(target, property, attributes) {\n\t\t\ttarget.setItem(\n\t\t\t\tclient.url.host + \"@\" + (property as string),\n\t\t\t\tattributes.value\n\t\t\t);\n\n\t\t\treturn true;\n\t\t},\n\t};\n\n\tconst realLocalStorage = self.localStorage;\n\tconst realSessionStorage = self.sessionStorage;\n\n\tconst localStorageProxy = new Proxy(self.localStorage, handler);\n\tconst sessionStorageProxy = new Proxy(self.sessionStorage, handler);\n\n\tdelete self.localStorage;\n\tdelete self.sessionStorage;\n\n\tself.localStorage = localStorageProxy;\n\tself.sessionStorage = sessionStorageProxy;\n}\n","export class NavigateEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"navigate\");\n\t}\n}\n\nexport class UrlChangeEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"urlchange\");\n\t}\n}\n","// import { encodeUrl } from \"../shared\";\nimport { iswindow } from \".\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\n// import { config } from \"../shared\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\nimport { indirectEval } from \"./shared/eval\";\n\nexport const UNSAFE_GLOBALS = [\n\t\"window\",\n\t\"self\",\n\t\"globalThis\",\n\t\"this\",\n\t\"parent\",\n\t\"top\",\n\t\"location\",\n\t\"document\",\n\t\"eval\",\n\t\"frames\",\n];\n\nexport function createGlobalProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n): typeof globalThis {\n\treturn new Proxy(self, {\n\t\tget(target, prop) {\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\tif (\n\t\t\t\tiswindow &&\n\t\t\t\t(typeof prop === \"string\" || typeof prop === \"number\") &&\n\t\t\t\t!isNaN(Number(prop)) &&\n\t\t\t\tvalue\n\t\t\t) {\n\t\t\t\tconst win: Self = value.self;\n\t\t\t\t// indexing into window gives you the contentWindow of the subframes for some reason\n\t\t\t\t// you can't *set* it so this should always be the right value\n\t\t\t\tif (SCRAMJETCLIENT in win) {\n\t\t\t\t\t// then we've already hooked this frame and we can just send over its proxy\n\t\t\t\t\treturn win[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t} else {\n\t\t\t\t\t// this can happen if it's an about:blank iframe that we've never gotten the chance to inject into\n\t\t\t\t\t// just make a new client for it and inject\n\t\t\t\t\tconst newclient = new ScramjetClient(win);\n\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\treturn newclient.globalProxy;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prop === \"$scramjet\") return null;\n\n\t\t\tif (typeof prop === \"string\" && UNSAFE_GLOBALS.includes(prop))\n\t\t\t\treturn client.wrapfn(value);\n\n\t\t\treturn value;\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tclient.url = value;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, value);\n\t\t},\n\t\thas(target, prop) {\n\t\t\tif (prop === \"$scramjet\") return false;\n\n\t\t\treturn Reflect.has(target, prop);\n\t\t},\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target).filter((key) => key !== \"$scramjet\");\n\t\t},\n\t\tdefineProperty(target, property, attributes) {\n\t\t\tif (!attributes.get && !attributes.set) {\n\t\t\t\tattributes.writable = true;\n\t\t\t}\n\t\t\tattributes.configurable = true;\n\n\t\t\treturn Reflect.defineProperty(target, property, attributes);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","export function getOwnPropertyDescriptorHandler(target, prop) {\n\tconst realDescriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\n\treturn realDescriptor;\n\t// const d: PropertyDescriptor = {};\n\n\t// if (realDescriptor.enumerable !== undefined)\n\t// \td.enumerable = realDescriptor.enumerable;\n\t// if (realDescriptor.configurable !== undefined)\n\t// \td.configurable = realDescriptor.configurable;\n\t// if (realDescriptor.writable !== undefined)\n\t// \td.writable = realDescriptor.writable;\n\n\t// if (realDescriptor.get) {\n\t// \td.get = () => this.get(target, prop);\n\t// }\n\n\t// if (realDescriptor.set) {\n\t// \td.set = (value) => this.set(target, prop, value);\n\t// }\n\n\t// if (realDescriptor.value) {\n\t// \td.value = this.get(target, prop);\n\t// }\n\n\t// return d;\n}\n","// entrypoint for scramjet.client.js\n\nimport { loadCodecs } from \"../scramjet\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\nimport { ScramjetServiceWorkerRuntime } from \"./swruntime\";\n\nexport const iswindow = \"window\" in self;\nexport const isworker = \"WorkerGlobalScope\" in self;\nexport const issw = \"ServiceWorkerGlobalScope\" in self;\nexport const isdedicated = \"DedicatedWorkerGlobalScope\" in self;\nexport const isshared = \"SharedWorkerGlobalScope\" in self;\nexport const isemulatedsw =\n\tnew URL(self.location.href).searchParams.get(\"dest\") === \"serviceworker\";\n\nexport class ScramjetContextInit extends Event {\n\tpublic window: Self;\n}\n\ndbg.log(\"scrammin\");\n// if it already exists, that means the handlers have probably already been setup by the parent document\nif (!(SCRAMJETCLIENT in <Partial<typeof self>>self)) {\n\tloadCodecs();\n\n\tconst client = new ScramjetClient(self);\n\n\tif (self.COOKIE) client.loadcookies(self.COOKIE);\n\n\tclient.hook();\n\n\tif (isemulatedsw) {\n\t\tconst runtime = new ScramjetServiceWorkerRuntime(client);\n\t\truntime.hook();\n\t}\n\n\tconst ev = new ScramjetContextInit(\"contextInit\");\n\tev.window = client.global.window;\n\tclient.frame?.dispatchEvent(ev);\n}\n\nif (\"document\" in self && document?.currentScript) {\n\tdocument.currentScript.remove();\n}\n","// @ts-nocheck\nimport { ScramjetClient } from \"./client\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport { unrewriteUrl, rewriteUrl } from \"../shared\";\nimport { iswindow } from \".\";\n\nexport function createLocationProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\tconst Location = iswindow ? self.Location : self.WorkerLocation;\n\t// location cannot be Proxy()d\n\tconst fakeLocation = {};\n\tObject.setPrototypeOf(fakeLocation, Location.prototype);\n\tfakeLocation.constructor = Location;\n\n\t// for some reason it's on the object for Location and on the prototype for WorkerLocation??\n\tconst descriptorSource = iswindow ? self.location : Location.prototype;\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"href\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tconst native = nativeGetOwnPropertyDescriptor(descriptorSource, prop);\n\t\tif (!native) continue;\n\n\t\tconst desc = {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t};\n\t\tif (native.get) {\n\t\t\tdesc.get = new Proxy(native.get, {\n\t\t\t\tapply() {\n\t\t\t\t\treturn client.url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tif (native.set) {\n\t\t\tdesc.set = new Proxy(native.set, {\n\t\t\t\tapply(target, thisArg, args) {\n\t\t\t\t\tif (prop === \"href\") {\n\t\t\t\t\t\t// special case\n\t\t\t\t\t\tclient.url = args[0];\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst url = new URL(client.url.href);\n\t\t\t\t\turl[prop] = args[0];\n\t\t\t\t\tclient.url = url;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tObject.defineProperty(fakeLocation, prop, desc);\n\t}\n\n\t// functions\n\tfakeLocation.toString = new Proxy(self.location.toString, {\n\t\tapply() {\n\t\t\treturn client.url.href;\n\t\t},\n\t});\n\n\tif (self.location.valueOf)\n\t\tfakeLocation.valueOf = new Proxy(self.location.valueOf, {\n\t\t\tapply() {\n\t\t\t\treturn client.url.href;\n\t\t\t},\n\t\t});\n\tif (self.location.assign)\n\t\tfakeLocation.assign = new Proxy(self.location.assign, {\n\t\t\tapply(target, thisArg, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\tif (self.location.reload)\n\t\tfakeLocation.reload = new Proxy(self.location.reload, {\n\t\t\tapply(target, thisArg, args) {\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\tif (self.location.replace)\n\t\tfakeLocation.replace = new Proxy(self.location.replace, {\n\t\t\tapply(target, thisArg, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\n\treturn fakeLocation;\n}\n","export const nativeFunction = self.Function;\nexport const nativeGetOwnPropertyDescriptor =\n\tself.Object.getOwnPropertyDescriptor;\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"console.clear\", {\n\t\tapply(ctx) {\n\t\t\t// fuck you\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tconst log = console.log;\n\tclient.Trap(\"console.log\", {\n\t\tset(ctx, v) {\n\t\t\t// is there a legitimate reason to let sites do this?\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn log;\n\t\t},\n\t});\n}\n","import { rewriteBlob, unrewriteBlob } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nexport default function (client: ScramjetClient) {\n\t// hide the origin from object urls from the page\n\tclient.Proxy(\"URL.createObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tconst url: string = ctx.call();\n\t\t\tif (url.startsWith(\"blob:\")) {\n\t\t\t\tctx.return(rewriteBlob(url, client.meta));\n\t\t\t} else {\n\t\t\t\tctx.return(url);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"URL.revokeObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = unrewriteBlob(ctx.args[0]);\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { config } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"captureErrors\", client.url);\nexport function argdbg(arg, recurse = []) {\n\tswitch (typeof arg) {\n\t\tcase \"string\":\n\t\t\tif (arg.includes(\"localhost:1337/scramjet/\") && arg.includes(\"m3u8\"))\n\t\t\t\t// eslint-disable-next-line no-debugger\n\t\t\t\tdebugger;\n\t\t\tbreak;\n\t\tcase \"object\":\n\t\t\t// if (arg instanceof Location) debugger;\n\t\t\tif (\n\t\t\t\targ &&\n\t\t\t\targ[Symbol.iterator] &&\n\t\t\t\ttypeof arg[Symbol.iterator] === \"function\"\n\t\t\t)\n\t\t\t\tfor (const prop in arg) {\n\t\t\t\t\t// make sure it's not a getter\n\t\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(arg, prop);\n\t\t\t\t\tif (desc && desc.get) continue;\n\n\t\t\t\t\tconst ar = arg[prop];\n\t\t\t\t\tif (recurse.includes(ar)) continue;\n\t\t\t\t\trecurse.push(ar);\n\t\t\t\t\targdbg(ar, recurse);\n\t\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tself.$scramerr = function scramerr(e) {\n\t\tconsole.warn(\"CAUGHT ERROR\", e);\n\t};\n\n\tself.$scramdbg = function scramdbg(args, t) {\n\t\tif (args && typeof args === \"object\" && args.length > 0) argdbg(args);\n\t\targdbg(t);\n\n\t\treturn t;\n\t};\n\n\tclient.Proxy(\"Promise.prototype.catch\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = new Proxy(ctx.args[0], {\n\t\t\t\tapply(target, thisArg, argArray) {\n\t\t\t\t\t// console.warn(\"CAUGHT PROMISE REJECTION\", argArray);\n\t\t\t\t\tReflect.apply(target, thisArg, argArray);\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { config, unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"cleanerrors\", client.url);\nexport default function (client: ScramjetClient, _self: Self) {\n\t// v8 only. all we need to do is clean the scramjet urls from stack traces\n\tconst closure = (error, stack) => {\n\t\tlet newstack = error.stack;\n\n\t\tfor (let i = 0; i < stack.length; i++) {\n\t\t\tconst url = stack[i].getFileName();\n\n\t\t\tif (url.endsWith(config.files.client)) {\n\t\t\t\t// strip stack frames including scramjet handlers from the trace\n\t\t\t\tconst lines = newstack.split(\"\\n\");\n\t\t\t\tconst line = lines.find((l) => l.includes(url));\n\t\t\t\tlines.splice(line, 1);\n\t\t\t\tnewstack = lines.join(\"\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tnewstack = newstack.replaceAll(url, unrewriteUrl(url));\n\t\t\t} catch {}\n\t\t}\n\n\t\treturn newstack;\n\t};\n\tclient.Trap(\"Error.prepareStackTrace\", {\n\t\tget(_ctx) {\n\t\t\t// this is a funny js quirk. the getter is ran every time you type something in console\n\t\t\treturn closure;\n\t\t},\n\t\tset(_value) {\n\t\t\t// just ignore it if a site tries setting their own. not much we can really do\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config, rewriteJs } from \"../../shared\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// used for proxying *direct eval*\n\t// eval(\"...\") -> eval($scramjet$rewrite(\"...\"))\n\tObject.defineProperty(self, config.globals.rewritefn, {\n\t\tvalue: function (js: any) {\n\t\t\tif (typeof js !== \"string\") return js;\n\n\t\t\tconst rewritten = rewriteJs(js, client.meta);\n\n\t\t\treturn rewritten;\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n\nexport function indirectEval(this: ScramjetClient, js: any) {\n\t// > If the argument of eval() is not a string, eval() returns the argument unchanged\n\tif (typeof js !== \"string\") return js;\n\n\tconst indirection = this.global.eval;\n\n\treturn indirection(rewriteJs(js, this.meta) as string);\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { getOwnPropertyDescriptorHandler } from \"../helpers\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport { unproxy } from \"./unproxy\";\n\nconst realOnEvent = Symbol.for(\"scramjet original onevent function\");\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst handlers = {\n\t\tmessage: {\n\t\t\t_init() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$type\" in this.data) {\n\t\t\t\t\t// this is a ctl message\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tports() {\n\t\t\t\t// don't know why i have to do this?\n\t\t\t\treturn this.ports;\n\t\t\t},\n\t\t\tsource() {\n\t\t\t\tif (this.source === null) return null;\n\n\t\t\t\tconst scram: ScramjetClient = this.source[SCRAMJETCLIENT];\n\n\t\t\t\tif (scram) return scram.globalProxy;\n\n\t\t\t\treturn this.source;\n\t\t\t},\n\t\t\torigin() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$origin\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$origin;\n\n\t\t\t\treturn client.url.origin;\n\t\t\t},\n\t\t\tdata() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$data\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$data;\n\n\t\t\t\treturn this.data;\n\t\t\t},\n\t\t},\n\t};\n\n\t// TODO! window.event not proxied\n\n\tfunction wraplistener(listener: (...args: any) => any) {\n\t\treturn new Proxy(listener, {\n\t\t\tapply(target, thisArg, argArray) {\n\t\t\t\tconst realEvent: Event = argArray[0];\n\n\t\t\t\t// we only need to handle events dispatched from the browser\n\t\t\t\tif (realEvent.isTrusted) {\n\t\t\t\t\tconst type = realEvent.type;\n\n\t\t\t\t\tif (type in handlers) {\n\t\t\t\t\t\tconst handler = handlers[type];\n\n\t\t\t\t\t\tif (handler._init) {\n\t\t\t\t\t\t\tif (handler._init.call(realEvent) === false) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\targArray[0] = new Proxy(realEvent, {\n\t\t\t\t\t\t\tget(_target, prop, reciever) {\n\t\t\t\t\t\t\t\tif (prop in handler) {\n\t\t\t\t\t\t\t\t\treturn handler[prop].call(_target);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn Reflect.get(target, prop, reciever);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!self.event) {\n\t\t\t\t\tObject.defineProperty(self, \"event\", {\n\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\treturn argArray[0];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst rv = Reflect.apply(target, thisArg, argArray);\n\n\t\t\t\treturn rv;\n\t\t\t},\n\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t});\n\t}\n\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst origlistener = ctx.args[1];\n\t\t\tconst proxylistener = wraplistener(origlistener);\n\n\t\t\tctx.args[1] = proxylistener;\n\n\t\t\tlet arr = client.eventcallbacks.get(ctx.this);\n\t\t\tarr ||= [] as any;\n\t\t\tarr.push({\n\t\t\t\tevent: ctx.args[0] as string,\n\t\t\t\toriginalCallback: origlistener,\n\t\t\t\tproxiedCallback: proxylistener,\n\t\t\t});\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst arr = client.eventcallbacks.get(ctx.this);\n\t\t\tif (!arr) return;\n\n\t\t\tconst i = arr.findIndex(\n\t\t\t\t(e) => e.event === ctx.args[0] && e.originalCallback === ctx.args[1]\n\t\t\t);\n\t\t\tif (i === -1) return;\n\n\t\t\tconst r = arr.splice(i, 1);\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\n\t\t\tctx.args[1] = r[0].proxiedCallback;\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.dispatchEvent\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t},\n\t});\n\n\tconst targets = [self.self, self.MessagePort.prototype] as Array<any>;\n\tif (iswindow) targets.push(self.HTMLElement.prototype);\n\tif (self.Worker) targets.push(self.Worker.prototype);\n\n\tfor (const target of targets) {\n\t\tconst keys = Reflect.ownKeys(target);\n\n\t\tfor (const key of keys) {\n\t\t\tif (\n\t\t\t\ttypeof key === \"string\" &&\n\t\t\t\tkey.startsWith(\"on\") &&\n\t\t\t\thandlers[key.slice(2)]\n\t\t\t) {\n\t\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(target, key);\n\t\t\t\tif (!descriptor.get || !descriptor.set || !descriptor.configurable)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// these are the `onmessage`, `onclick`, etc. properties\n\t\t\t\tclient.RawTrap(target, key, {\n\t\t\t\t\tget(ctx) {\n\t\t\t\t\t\tif (this[realOnEvent]) return this[realOnEvent];\n\n\t\t\t\t\t\treturn ctx.get();\n\t\t\t\t\t},\n\t\t\t\t\tset(ctx, value: any) {\n\t\t\t\t\t\tthis[realOnEvent] = value;\n\n\t\t\t\t\t\tif (typeof value !== \"function\") return ctx.set(value);\n\n\t\t\t\t\t\tctx.set(wraplistener(value));\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ScramjetClient, ProxyCtx, Proxy } from \"../client\";\nimport { rewriteJs } from \"../../shared\";\n\nfunction rewriteFunction(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst stringifiedFunction = ctx.call().toString();\n\n\tconst content = rewriteJs(`return ${stringifiedFunction}`, client.meta);\n\tctx.return(ctx.fn(content)());\n}\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst handler: Proxy = {\n\t\tapply(ctx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t\tconstruct(ctx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t};\n\n\tclient.Proxy(\"Function\", handler);\n\n\t// god i love javascript\n\tclient.RawProxy(function () {}.constructor.prototype, \"constructor\", handler);\n\tclient.RawProxy(\n\t\tasync function () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tfunction* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tasync function* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n}\n","let wasm;\n\nlet WASM_VECTOR_LEN = 0;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.buffer !== wasm.memory.buffer) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nconst cachedTextEncoder = (typeof TextEncoder !== 'undefined' ? new TextEncoder('utf-8') : { encode: () => { throw Error('TextEncoder not available') } } );\n\nconst encodeString = function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n};\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer !== wasm.memory.buffer) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().slice(ptr, ptr + len));\n}\n\nexport function init() {\n    wasm.init();\n}\n\nfunction getArrayU8FromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return getUint8ArrayMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n/**\n * @param {string} js\n * @param {string} url\n * @param {object} scramjet\n * @returns {Uint8Array}\n */\nexport function rewrite_js(js, url, scramjet) {\n    const ptr0 = passStringToWasm0(js, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js(ptr0, len0, ptr1, len1, scramjet);\n    var v3 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n    wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n    return v3;\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n/**\n * @param {Uint8Array} js\n * @param {string} url\n * @param {object} scramjet\n * @returns {Uint8Array}\n */\nexport function rewrite_js_from_arraybuffer(js, url, scramjet) {\n    const ptr0 = passArray8ToWasm0(js, wasm.__wbindgen_malloc);\n    const len0 = WASM_VECTOR_LEN;\n    const ptr1 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n    const len1 = WASM_VECTOR_LEN;\n    const ret = wasm.rewrite_js_from_arraybuffer(ptr0, len0, ptr1, len1, scramjet);\n    var v3 = getArrayU8FromWasm0(ret[0], ret[1]).slice();\n    wasm.__wbindgen_free(ret[0], ret[1] * 1, 1);\n    return v3;\n}\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_3.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbindgen_string_get = function(arg0, arg1) {\n        const obj = arg1;\n        const ret = typeof(obj) === 'string' ? obj : undefined;\n        var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbg_new_1cabf49927794f50 = function() { return handleError(function (arg0, arg1) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_5fb7c8066a4a4825 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = arg0.call(arg1, arg2, arg3);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbindgen_boolean_get = function(arg0) {\n        const v = arg0;\n        const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;\n        return ret;\n    };\n    imports.wbg.__wbg_new_abda76e883ba8a5f = function() {\n        const ret = new Error();\n        return ret;\n    };\n    imports.wbg.__wbg_stack_658279fe44541cf6 = function(arg0, arg1) {\n        const ret = arg1.stack;\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_error_f851667af71bcfc6 = function(arg0, arg1) {\n        let deferred0_0;\n        let deferred0_1;\n        try {\n            deferred0_0 = arg0;\n            deferred0_1 = arg1;\n            console.error(getStringFromWasm0(arg0, arg1));\n        } finally {\n            wasm.__wbindgen_free(deferred0_0, deferred0_1, 1);\n        }\n    };\n    imports.wbg.__wbindgen_is_object = function(arg0) {\n        const val = arg0;\n        const ret = typeof(val) === 'object' && val !== null;\n        return ret;\n    };\n    imports.wbg.__wbg_crypto_1d1f22824a6a080c = function(arg0) {\n        const ret = arg0.crypto;\n        return ret;\n    };\n    imports.wbg.__wbg_process_4a72847cc503995b = function(arg0) {\n        const ret = arg0.process;\n        return ret;\n    };\n    imports.wbg.__wbg_versions_f686565e586dd935 = function(arg0) {\n        const ret = arg0.versions;\n        return ret;\n    };\n    imports.wbg.__wbg_node_104a2ff8d6ea03a2 = function(arg0) {\n        const ret = arg0.node;\n        return ret;\n    };\n    imports.wbg.__wbindgen_is_string = function(arg0) {\n        const ret = typeof(arg0) === 'string';\n        return ret;\n    };\n    imports.wbg.__wbg_require_cca90b1a94a0255b = function() { return handleError(function () {\n        const ret = module.require;\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_msCrypto_eb05e62b530a1508 = function(arg0) {\n        const ret = arg0.msCrypto;\n        return ret;\n    };\n    imports.wbg.__wbg_newwithlength_76462a666eca145f = function(arg0) {\n        const ret = new Uint8Array(arg0 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbindgen_is_function = function(arg0) {\n        const ret = typeof(arg0) === 'function';\n        return ret;\n    };\n    imports.wbg.__wbg_get_ef828680c64da212 = function() { return handleError(function (arg0, arg1) {\n        const ret = Reflect.get(arg0, arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_self_bf91bf94d9e04084 = function() { return handleError(function () {\n        const ret = self.self;\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_window_52dd9f07d03fd5f8 = function() { return handleError(function () {\n        const ret = window.window;\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_globalThis_05c129bf37fcf1be = function() { return handleError(function () {\n        const ret = globalThis.globalThis;\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_global_3eca19bb09e9c484 = function() { return handleError(function () {\n        const ret = global.global;\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbindgen_is_undefined = function(arg0) {\n        const ret = arg0 === undefined;\n        return ret;\n    };\n    imports.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43 = function(arg0, arg1) {\n        const ret = new Function(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbg_call_a9ef466721e824f2 = function() { return handleError(function (arg0, arg1) {\n        const ret = arg0.call(arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_3bfa248576352471 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = arg0.call(arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbg_buffer_ccaed51a635d8a2d = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_7e3eb787208af730 = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_randomFillSync_5c9c955aa56b6049 = function() { return handleError(function (arg0, arg1) {\n        arg0.randomFillSync(arg1);\n    }, arguments) };\n    imports.wbg.__wbg_subarray_975a06f9dbd16995 = function(arg0, arg1, arg2) {\n        const ret = arg0.subarray(arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_getRandomValues_3aa56aa6edec874c = function() { return handleError(function (arg0, arg1) {\n        arg0.getRandomValues(arg1);\n    }, arguments) };\n    imports.wbg.__wbg_new_fec2611eb9180f95 = function(arg0) {\n        const ret = new Uint8Array(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_set_ec2fcf81bc573fd9 = function(arg0, arg1, arg2) {\n        arg0.set(arg1, arg2 >>> 0);\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_3;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n    imports.wbg.memory = memory || new WebAssembly.Memory({initial:22,maximum:16384,shared:true});\n}\n\nfunction __wbg_finalize_init(instance, module, thread_stack_size) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\nif (typeof thread_stack_size !== 'undefined' && (typeof thread_stack_size !== 'number' || thread_stack_size === 0 || thread_stack_size % 65536 !== 0)) { throw 'invalid stack size' }\nwasm.__wbindgen_start(thread_stack_size);\nreturn wasm;\n}\n\nfunction initSync(module, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module, memory, thread_stack_size} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports, memory);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nasync function __wbg_init(module_or_path, memory) {\n    if (wasm !== undefined) return wasm;\n\n    let thread_stack_size\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path, memory, thread_stack_size} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('rewriter_bg.wasm', \"\");\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports, memory);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module, thread_stack_size);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","import { URLMeta } from \"./url\";\n\n// i am a cat. i like to be petted. i like to be fed. i like to be\nimport {\n\tinit,\n\tinitSync,\n\trewrite_js,\n\trewrite_js_from_arraybuffer,\n} from \"../../../rewriter/out/rewriter.js\";\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\n\ninitSync({\n\tmodule: new WebAssembly.Module(\n\t\tUint8Array.from(atob(self.WASM), (c) => c.charCodeAt(0))\n\t),\n});\n\ninit();\n\nError.stackTraceLimit = 50;\n\nexport function rewriteJs(js: string | ArrayBuffer, meta: URLMeta) {\n\tif (flagEnabled(\"naiiveRewriter\", meta.origin)) {\n\t\tconst text = typeof js === \"string\" ? js : new TextDecoder().decode(js);\n\n\t\tconsole.log(\"naiive\");\n\t\treturn rewriteJsNaiive(text);\n\t}\n\n\t// const before = performance.now();\n\tif (typeof js === \"string\") {\n\t\tjs = new TextDecoder().decode(rewrite_js(js, meta.base.href, $scramjet));\n\t} else {\n\t\tjs = rewrite_js_from_arraybuffer(\n\t\t\tnew Uint8Array(js),\n\t\t\tmeta.base.href,\n\t\t\t$scramjet\n\t\t);\n\t}\n\t// const after = performance.now();\n\n\t// dbg.debug(\"Rewrite took\", Math.floor((after - before) * 10) / 10, \"ms\");\n\n\treturn js;\n}\n\n// 1. does not work with modules\n// 2. cannot proxy import()\n// 3. disables \"use strict\" optimizations\n// 4. i think the global state can get clobbered somehow\n//\n// if you can ensure all the preconditions are met this is faster than full rewrites\nexport function rewriteJsNaiive(js: string | ArrayBuffer) {\n\tif (typeof js !== \"string\") {\n\t\tjs = new TextDecoder().decode(js);\n\t}\n\n\treturn `\n\t\twith (${$scramjet.config.globals.wrapfn}(globalThis)) {\n\n\t\t\t${js}\n\n\t\t}\n\t`;\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared/rewriters/url\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst Function = client.natives.Function;\n\n\tself[config.globals.importfn] = function (base: string) {\n\t\treturn function (url: string) {\n\t\t\tconst resolved = new URL(url, base).href;\n\n\t\t\treturn Function(\n\t\t\t\t`return import(\"${rewriteUrl(resolved, client.meta)}\")`\n\t\t\t)();\n\t\t};\n\t};\n\n\tself[config.globals.metafn] = function (base: string) {\n\t\treturn {\n\t\t\turl: base,\n\t\t\tresolve: function (url: string) {\n\t\t\t\treturn new URL(url, base).href;\n\t\t\t},\n\t\t};\n\t};\n}\n","import { $scramjet } from \"../../scramjet\";\nimport { rewriteJs } from \"./js\";\n\nexport type URLMeta = {\n\torigin: URL;\n\tbase: URL;\n};\n\nfunction tryCanParseURL(url: string, origin?: string | URL): URL | null {\n\ttry {\n\t\treturn new URL(url, origin);\n\t} catch {\n\t\treturn null;\n\t}\n}\n\nexport function rewriteBlob(url: string, meta: URLMeta) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + meta.origin.origin + blob.pathname;\n}\n\nexport function unrewriteBlob(url: string) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + location.origin + blob.pathname;\n}\n\nexport function rewriteUrl(url: string | URL, meta: URLMeta) {\n\tif (url instanceof URL) {\n\t\turl = url.href;\n\t}\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\treturn \"javascript:\" + rewriteJs(url.slice(\"javascript:\".length), meta);\n\t} else if (url.startsWith(\"blob:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"data:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else {\n\t\tlet base = meta.base.href;\n\n\t\tif (base.startsWith(\"about:\")) base = unrewriteUrl(self.location.href); // jank!!!!! weird jank!!!\n\n\t\treturn (\n\t\t\tlocation.origin +\n\t\t\t$scramjet.config.prefix +\n\t\t\t$scramjet.codec.encode(new URL(url, base).href)\n\t\t);\n\t}\n}\n\nexport function unrewriteUrl(url: string | URL) {\n\tif (url instanceof URL) {\n\t\turl = url.href;\n\t}\n\n\tconst prefixed = location.origin + $scramjet.config.prefix;\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\t//TODO\n\t\treturn url;\n\t} else if (url.startsWith(\"blob:\")) {\n\t\t// realistically this shouldn't happen\n\t\treturn url;\n\t} else if (url.startsWith(prefixed + \"blob:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(prefixed + \"data:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else if (tryCanParseURL(url)) {\n\t\treturn $scramjet.codec.decode(\n\t\t\turl.slice((location.origin + $scramjet.config.prefix).length)\n\t\t);\n\t} else {\n\t\treturn url;\n\t}\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tclient.Proxy(\"IDBFactory.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Trap(\"IDBDatabase.prototype.name\", {\n\t\tget(ctx) {\n\t\t\tconst name = ctx.get() as string;\n\n\t\t\treturn name.substring(name.indexOf(\"@\") + 1);\n\t\t},\n\t});\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { POLLUTANT } from \"../shared/realm\";\n\nexport default function (client: ScramjetClient) {\n\tif (iswindow)\n\t\tclient.Proxy(\"window.postMessage\", {\n\t\t\tapply(ctx) {\n\t\t\t\t// so we need to send the real origin here, since the recieving window can't possibly know.\n\t\t\t\t// except, remember that this code is being ran in a different realm than the invoker, so if we ask our `client` it may give us the wrong origin\n\t\t\t\t// if we were given any object that came from the real realm we can use that to get the real origin\n\t\t\t\t// and this works in every case EXCEPT for the fact that all three arguments can be strings which are copied instead of cloned\n\t\t\t\t// so we have to use `$setrealm` which will pollute this with an object from the real realm\n\n\t\t\t\tlet pollutant;\n\n\t\t\t\tif (typeof ctx.args[0] === \"object\" && ctx.args[0] !== null) {\n\t\t\t\t\tpollutant = ctx.args[0]; // try to use the first object we can find because it's more reliable\n\t\t\t\t} else if (typeof ctx.args[2] === \"object\" && ctx.args[2] !== null) {\n\t\t\t\t\tpollutant = ctx.args[2]; // next try to use transfer\n\t\t\t\t} else if (\n\t\t\t\t\tPOLLUTANT in ctx.this &&\n\t\t\t\t\ttypeof ctx.this[POLLUTANT] === \"object\" &&\n\t\t\t\t\tctx.this[POLLUTANT] !== null\n\t\t\t\t) {\n\t\t\t\t\tpollutant = ctx.this[POLLUTANT]; // lastly try to use the object from $setrealm\n\t\t\t\t} else {\n\t\t\t\t\tpollutant = {}; // give up\n\t\t\t\t}\n\n\t\t\t\t// and now we can steal Function from the caller's realm\n\t\t\t\tconst {\n\t\t\t\t\tconstructor: { constructor: Function },\n\t\t\t\t} = pollutant;\n\n\t\t\t\t// invoking stolen function will give us the caller's globalThis, remember scramjet has already proxied it!!!\n\t\t\t\tconst callerGlobalThisProxied: Self = Function(\"return globalThis\")();\n\t\t\t\tconst callerClient = callerGlobalThisProxied[SCRAMJETCLIENT];\n\n\t\t\t\t// this WOULD be enough but the source argument of MessageEvent has to return the caller's window\n\t\t\t\t// and if we just call it normally it would be coming from here, which WILL NOT BE THE CALLER'S because the accessor is from the parent\n\t\t\t\t// so with the stolen function we wrap postmessage so the source will truly be the caller's window (remember that function is scramjet's!!!)\n\t\t\t\tconst wrappedPostMessage = Function(\n\t\t\t\t\t\"data\",\n\t\t\t\t\t\"origin\",\n\t\t\t\t\t\"transfer\",\n\t\t\t\t\t\"this(data, origin, transfer)\"\n\t\t\t\t);\n\n\t\t\t\tctx.args[0] = {\n\t\t\t\t\t$scramjet$messagetype: \"window\",\n\t\t\t\t\t$scramjet$origin: callerClient.url.origin,\n\t\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t\t};\n\n\t\t\t\t// * origin because obviously\n\t\t\t\tctx.args[1] = \"*\";\n\n\t\t\t\tctx.return(\n\t\t\t\t\twrappedPostMessage.call(ctx.fn, ctx.args[0], ctx.args[1], ctx.args[2])\n\t\t\t\t);\n\t\t\t},\n\t\t});\n\n\tconst toproxy = [\"MessagePort.prototype.postMessage\"];\n\n\tif (self.Worker) toproxy.push(\"Worker.prototype.postMessage\");\n\tif (!iswindow) toproxy.push(\"self.postMessage\"); // only do the generic version if we're in a worker\n\n\tclient.Proxy(toproxy, {\n\t\tapply(ctx) {\n\t\t\t// origin/source doesn't need to be preserved - it's null in the message event\n\n\t\t\tctx.args[0] = {\n\t\t\t\t$scramjet$messagetype: \"worker\",\n\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t};\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\n\nexport const POLLUTANT = Symbol.for(\"scramjet realm pollutant\");\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// object.$setrealm({}).postMessage(...)\n\t// the empty object is the \"pollutant\" which can reconstruct the real realm\n\t// i explain more in postmessage.ts\n\tObject.defineProperty(self.Object.prototype, config.globals.setrealmfn, {\n\t\tvalue(pollution: {}) {\n\t\t\t// this is bad!! sites could detect this\n\t\t\tObject.defineProperty(this, POLLUTANT, {\n\t\t\t\tvalue: pollution,\n\t\t\t\twritable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: false,\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\t\twritable: true,\n\t\tconfigurable: true,\n\t\tenumerable: false,\n\t});\n}\n","import { rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient, self) {\n\tclient.Proxy(\"navigator.sendBeacon\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n}\n","import { unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"EventSource\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Trap(\"EventSource.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tunrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","// ts throws an error if you dont do window.fetch\n\nimport { isemulatedsw } from \"../..\";\nimport { unrewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\nimport { rewriteUrl } from \"../../../shared\";\n\nexport default function (client: ScramjetClient, _self: typeof globalThis) {\n\tclient.Proxy(\"fetch\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0].toString(), client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\t// client.Proxy(\"Headers\", {\n\t// \tconstruct(ctx) {\n\t// \t\tctx.args[0] = rewriteHeaders(ctx.args[0]);\n\t// \t},\n\t// });\n\n\tclient.Proxy(\"Request\", {\n\t\tconstruct(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0].toString(), client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Response.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n\n\tclient.Trap(\"Request.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n\n\t// client.Proxy(\"Response.redirect\", {\n\t// \tapply(ctx) {\n\t// \t\tctx.args[0] = encodeUrl(ctx.args[0]);\n\t// \t},\n\t// });\n}\n","import { type BareWebSocket } from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetClient } from \"../../client\";\n\ntype FakeWebSocketState = {\n\textensions: string;\n\tprotocol: string;\n\turl: string;\n\tbinaryType: string;\n\tbarews: BareWebSocket;\n\n\tcaptureListeners: Record<string, EventListener[]>;\n\tlisteners: Record<string, EventListener[]>;\n\n\tonclose?: (ev: CloseEvent) => any;\n\tonerror?: (ev: Event) => any;\n\tonmessage?: (ev: MessageEvent) => any;\n\tonopen?: (ev: Event) => any;\n};\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tconst socketmap: WeakMap<WebSocket, FakeWebSocketState> = new WeakMap();\n\tclient.Proxy(\"WebSocket\", {\n\t\tconstruct(ctx) {\n\t\t\tconst fakeWebSocket = new EventTarget() as WebSocket;\n\t\t\tObject.setPrototypeOf(fakeWebSocket, self.WebSocket.prototype);\n\t\t\tfakeWebSocket.constructor = ctx.fn;\n\n\t\t\tconst trustEvent = (ev: Event) =>\n\t\t\t\tnew Proxy(ev, {\n\t\t\t\t\tget(target, prop) {\n\t\t\t\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\tconst barews = client.bare.createWebSocket(\n\t\t\t\tctx.args[0],\n\t\t\t\tctx.args[1],\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\t\"User-Agent\": self.navigator.userAgent,\n\t\t\t\t\tOrigin: client.url.origin,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst state: FakeWebSocketState = {\n\t\t\t\textensions: \"\",\n\t\t\t\tprotocol: \"\",\n\t\t\t\turl: ctx.args[0],\n\t\t\t\tbinaryType: \"blob\",\n\t\t\t\tbarews,\n\n\t\t\t\tcaptureListeners: {},\n\t\t\t\tlisteners: {},\n\t\t\t};\n\n\t\t\tfunction fakeEventSend(fakeev: Event) {\n\t\t\t\tstate[\"on\" + fakeev.type]?.(trustEvent(fakeev));\n\t\t\t\tfakeWebSocket.dispatchEvent(fakeev);\n\t\t\t}\n\n\t\t\tbarews.addEventListener(\"open\", () => {\n\t\t\t\tfakeEventSend(new Event(\"open\"));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"close\", (ev) => {\n\t\t\t\tfakeEventSend(new CloseEvent(\"close\", ev));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"message\", (ev) => {\n\t\t\t\tconst fakeev = new MessageEvent(\"message\", {\n\t\t\t\t\tdata: ev.data,\n\t\t\t\t\torigin: ev.origin,\n\t\t\t\t\tlastEventId: ev.lastEventId,\n\t\t\t\t\tsource: ev.source,\n\t\t\t\t\tports: ev.ports,\n\t\t\t\t});\n\n\t\t\t\tfakeEventSend(fakeev);\n\t\t\t});\n\t\t\tbarews.addEventListener(\"error\", () => {\n\t\t\t\tfakeEventSend(new Event(\"error\"));\n\t\t\t});\n\n\t\t\tsocketmap.set(fakeWebSocket, state);\n\t\t\tctx.return(fakeWebSocket);\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (!ws) return; // it's not a websocket ignore it\n\n\t\t\tconst [type, listener, opts] = ctx.args;\n\n\t\t\tif (\n\t\t\t\t(typeof opts === \"object\" && opts.capture) ||\n\t\t\t\t(typeof opts === \"boolean\" && opts)\n\t\t\t) {\n\t\t\t\tconst listeners = (ws.captureListeners[type] ??= []);\n\t\t\t\tlisteners.push(listener);\n\t\t\t\tws.captureListeners[type] = listeners;\n\t\t\t} else {\n\t\t\t\tconst listeners = (ws.listeners[type] ??= []);\n\t\t\t\tlisteners.push(listener);\n\t\t\t\tws.listeners[type] = listeners;\n\t\t\t}\n\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (!ws) return;\n\n\t\t\tconst [type, listener, opts] = ctx.args;\n\n\t\t\tif (\n\t\t\t\t(typeof opts === \"object\" && opts.capture) ||\n\t\t\t\t(typeof opts === \"boolean\" && opts)\n\t\t\t) {\n\t\t\t\tconst listeners = (ws.captureListeners[type] ??= []);\n\t\t\t\tconst idx = listeners.indexOf(listener);\n\t\t\t\tif (idx !== -1) listeners.splice(idx, 1);\n\t\t\t\tws.captureListeners[type] = listeners;\n\t\t\t} else {\n\t\t\t\tconst listeners = (ws.listeners[type] ??= []);\n\t\t\t\tconst idx = listeners.indexOf(listener);\n\t\t\t\tif (idx !== -1) listeners.splice(idx, 1);\n\t\t\t\tws.listeners[type] = listeners;\n\t\t\t}\n\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.binaryType\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.binaryType;\n\t\t},\n\t\tset(ctx, v: string) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (v === \"blob\" || v === \"arraybuffer\") ws.binaryType = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.bufferedAmount\", {\n\t\tget() {\n\t\t\treturn 0;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.extensions\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.extensions;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onclose\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onclose;\n\t\t},\n\t\tset(ctx, v: (ev: CloseEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onclose = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onerror\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onerror;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onerror = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onmessage\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onmessage;\n\t\t},\n\t\tset(ctx, v: (ev: MessageEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onmessage = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onopen\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onopen;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onopen = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.url;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.protocol\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.protocol;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.readyState\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.barews.readyState;\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\tctx.return(ws.barews.send(ctx.args[0]));\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.close\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (ctx.args[0] === undefined) ctx.args[0] = 1000;\n\t\t\tif (ctx.args[1] === undefined) ctx.args[1] = \"\";\n\t\t\tctx.return(ws.barews.close(ctx.args[0], ctx.args[1]));\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../../scramjet\";\nimport { config, unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\nlet nativeworker;\nlet postmessage;\n\nif (self.Worker) {\n\tnativeworker = Worker;\n\tpostmessage = Worker.prototype.postMessage;\n}\n\nexport default function (client: ScramjetClient, self: Self) {\n\tlet worker;\n\tif (self.Worker && flagEnabled(\"syncxhr\", client.url)) {\n\t\tworker = new nativeworker(config.files.sync);\n\t}\n\tconst ARGS = Symbol(\"xhr original args\");\n\tconst HEADERS = Symbol(\"xhr headers\");\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1]) ctx.args[1] = rewriteUrl(ctx.args[1], client.meta);\n\t\t\tctx.this[ARGS] = ctx.args;\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.setRequestHeader\", {\n\t\tapply(ctx) {\n\t\t\tconst headers = ctx.this[HEADERS] || (ctx.this[HEADERS] = {});\n\t\t\theaders[ctx.args[0]] = ctx.args[1];\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst args = ctx.this[ARGS];\n\t\t\tif (!args || args[2]) return;\n\n\t\t\tif (!flagEnabled(\"syncxhr\", client.url)) {\n\t\t\t\tconsole.warn(\"ignoring request - sync xhr disabled in flags\");\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// it's a sync request\n\t\t\t// sync xhr to service worker is not supported\n\t\t\t// there's a nice way of polyfilling this though, we can spin on an atomic using sharedarraybuffer. this will maintain the sync behavior\n\n\t\t\t// @ts-expect-error maxbytelength not in types yet i guess\n\t\t\tconst sab = new SharedArrayBuffer(1024, { maxByteLength: 2147483647 });\n\t\t\tconst view = new DataView(sab);\n\n\t\t\tpostmessage.call(worker, {\n\t\t\t\tsab,\n\t\t\t\targs,\n\t\t\t\theaders: ctx.this[HEADERS],\n\t\t\t\tbody: ctx.args[0],\n\t\t\t});\n\n\t\t\tconst now = performance.now();\n\t\t\twhile (view.getUint8(0) === 0) {\n\t\t\t\tif (performance.now() - now > 1000) {\n\t\t\t\t\tthrow new Error(\"xhr timeout\");\n\t\t\t\t}\n\t\t\t\t/* spin */\n\t\t\t}\n\n\t\t\tconst status = view.getUint16(1);\n\t\t\tconst headersLength = view.getUint32(3);\n\n\t\t\tconst headersab = new Uint8Array(headersLength);\n\t\t\theadersab.set(new Uint8Array(sab.slice(7, 7 + headersLength)));\n\t\t\tconst headers = new TextDecoder().decode(headersab);\n\n\t\t\tconst bodyLength = view.getUint32(7 + headersLength);\n\t\t\tconst bodyab = new Uint8Array(bodyLength);\n\t\t\tbodyab.set(\n\t\t\t\tnew Uint8Array(\n\t\t\t\t\tsab.slice(11 + headersLength, 11 + headersLength + bodyLength)\n\t\t\t\t)\n\t\t\t);\n\t\t\tconst body = new TextDecoder().decode(bodyab);\n\n\t\t\t// these should be using proxies to not leak scram strings but who cares\n\t\t\tclient.RawTrap(ctx.this, \"status\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn status;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseText\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"response\", {\n\t\t\t\tget() {\n\t\t\t\t\tif (ctx.this.responseType === \"arraybuffer\") return bodyab.buffer;\n\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseXML\", {\n\t\t\t\tget() {\n\t\t\t\t\tconst parser = new DOMParser();\n\n\t\t\t\t\treturn parser.parseFromString(body, \"text/xml\");\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getAllResponseHeaders\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn () => headers;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getResponseHeader\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn (header: string) => {\n\t\t\t\t\t\tconst re = new RegExp(`^${header}: (.*)$`, \"m\");\n\t\t\t\t\t\tconst match = re.exec(headers);\n\n\t\t\t\t\t\treturn match ? match[1] : null;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// send has no return value right\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tclient.Trap(\"XMLHttpRequest.prototype.responseURL\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { ScramjetClient } from \"../client\";\n\ntype Mapping = [string, number, number];\n\nconst sourcemaps: Record<string, Mapping[]> = {};\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"sourcemaps\", client.url);\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// every script will push a sourcemap\n\tObject.defineProperty(self, \"$scramjet$pushsourcemap\", {\n\t\tvalue: (maps: Mapping[], tag: string) => {\n\t\t\tsourcemaps[tag] = maps;\n\t\t},\n\t\tenumerable: false,\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\n\tconst scramtag_ident = \"/*scramtag \";\n\n\t// when we rewrite javascript it will make function.toString leak internals\n\t// this can lead to double rewrites which is bad\n\tclient.Proxy(\"Function.prototype.toString\", {\n\t\tapply(ctx) {\n\t\t\tlet stringified: string = ctx.fn.call(ctx.this);\n\t\t\tlet newString = \"\";\n\n\t\t\t// every function rewritten will have a scramtag comment\n\t\t\t// it will look like this:\n\t\t\t// function name() /*scramtag [index] [tag] */ { ... }\n\t\t\tconst scramtagstart = stringified.indexOf(\"/*s\");\n\n\t\t\tif (scramtagstart === -1) return ctx.return(stringified); // it's either a native function or something stolen from scramjet itself\n\n\t\t\tconst firstspace = stringified.indexOf(\n\t\t\t\t\" \",\n\t\t\t\tscramtagstart + scramtag_ident.length\n\t\t\t);\n\t\t\t// [index] holds the index of the first character in the scramtag (/)\n\t\t\tconst abstagindex = parseInt(\n\t\t\t\tstringified.substring(scramtagstart + scramtag_ident.length, firstspace)\n\t\t\t);\n\n\t\t\t// subtracting that from the index of the scramtag gives us the starting index of the function relative to the entire file\n\t\t\tconst absindex = abstagindex - scramtagstart;\n\n\t\t\tconst scramtagend = stringified.indexOf(\"*/\", scramtagstart);\n\t\t\tconst tag = stringified.substring(firstspace + 1, scramtagend);\n\n\t\t\t// delete all scramtags inside the function (and nested ones!!)\n\t\t\tstringified = stringified.replace(/\\/\\*scramtag.*?\\*\\//g, \"\");\n\n\t\t\tconst maps = sourcemaps[tag];\n\n\t\t\tlet i = 0;\n\t\t\tlet offset = 0;\n\n\t\t\tlet j = 0;\n\t\t\twhile (j < maps.length) {\n\t\t\t\tconst [str, start, end] = maps[j];\n\t\t\t\tif (start < absindex) {\n\t\t\t\t\tj++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (start - absindex + offset > stringified.length) break;\n\n\t\t\t\t// ooh i should really document this before i forget how it works\n\t\t\t\tnewString += stringified.slice(i, start - absindex + offset);\n\t\t\t\tnewString += str;\n\t\t\t\toffset += end - start - str.length;\n\t\t\t\ti = start - absindex + offset + str.length;\n\n\t\t\t\tj++;\n\t\t\t}\n\n\t\t\tnewString += stringified.slice(i);\n\n\t\t\treturn ctx.return(newString);\n\t\t},\n\t});\n}\n","export default function (client, self) {\n\tdelete self.TrustedHTML;\n\tdelete self.TrustedScript;\n\tdelete self.TrustedScriptURL;\n\tdelete self.TrustedTypePolicy;\n\tdelete self.TrustedTypePolicyFactory;\n\tdelete self.trustedTypes;\n}\n","import { iswindow } from \"..\";\nimport { ProxyCtx, ScramjetClient } from \"../client\";\n\n// we don't want to end up overriding a property on window that's derived from a prototype until we've proxied the prototype\nexport const order = 3;\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\t// an automated approach to cleaning the documentProxy from dom functions\n\t// it will trigger an illegal invocation if you pass the proxy to c++ code, we gotta hotswap it out with the real one\n\t// admittedly this is pretty slow. worth investigating if there's ways to get back some of the lost performance\n\n\tfor (const target of [self]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tif (typeof target[prop] === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\t}\n\n\tif (!iswindow) return;\n\n\tfor (const target of [\n\t\tself.Node.prototype,\n\t\tself.MutationObserver.prototype,\n\t\tself.document,\n\t]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tif (typeof target[prop] === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\t}\n\n\tclient.Proxy(\"Object.getOwnPropertyDescriptor\", {\n\t\tapply(ctx) {\n\t\t\tconst desc = ctx.call();\n\n\t\t\tif (!desc) return;\n\n\t\t\tif (desc.get) {\n\t\t\t\tclient.RawProxy(desc, \"get\", {\n\t\t\t\t\tapply(getCtx) {\n\t\t\t\t\t\t// value of this in the getter needs to be corrected\n\t\t\t\t\t\tunproxy(getCtx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (desc.set) {\n\t\t\t\tclient.RawProxy(desc, \"set\", {\n\t\t\t\t\tapply(setCtx) {\n\t\t\t\t\t\tunproxy(setCtx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// i don't think we have to care about value but it's worth looking into\n\n\t\t\tctx.return(desc);\n\t\t},\n\t});\n}\n\nexport function unproxy(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst self = client.global;\n\tif (ctx.this === client.globalProxy) ctx.this = self;\n\tif (ctx.this === client.documentProxy) ctx.this = self.document;\n\n\tfor (const i in ctx.args) {\n\t\tif (ctx.args[i] === client.documentProxy) ctx.args[i] = self.document;\n\t\tif (ctx.args[i] === client.globalProxy) ctx.args[i] = self;\n\t}\n}\n","import { iswindow } from \"..\";\nimport { BareMuxConnection } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared\";\nimport type { MessageC2W } from \"../../worker\";\nimport { ScramjetClient } from \"../client\";\n\nconst sharedworkerpostmessage = MessagePort.prototype.postMessage;\nlet workerpostmessage;\nif (self.Worker) {\n\tworkerpostmessage = Worker.prototype.postMessage;\n}\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tif (self.Worker) {\n\t\tclient.Proxy(\"Worker\", {\n\t\t\tconstruct({ args, call }) {\n\t\t\t\tif (args[0] instanceof URL) args[0] = args[0].href;\n\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta) + \"?dest=worker\";\n\n\t\t\t\tif (args[1] && args[1].type === \"module\") {\n\t\t\t\t\targs[0] += \"&type=module\";\n\t\t\t\t}\n\n\t\t\t\tconst worker = call();\n\t\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t\t(async () => {\n\t\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\t\tworkerpostmessage.call(\n\t\t\t\t\t\tworker,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\t\tport,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[port]\n\t\t\t\t\t);\n\t\t\t\t})();\n\t\t\t},\n\t\t});\n\t}\n\n\tif (iswindow) {\n\t\tclient.Proxy(\"Worklet.prototype.addModule\", {\n\t\t\tapply(ctx) {\n\t\t\t\tif (ctx.args[0]) ctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t},\n\t\t});\n\n\t\t// sharedworkers can only be constructed from window\n\t\tclient.Proxy(\"SharedWorker\", {\n\t\t\tconstruct({ args, call }) {\n\t\t\t\tif (args[0] instanceof URL) args[0] = args[0].href;\n\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta) + \"?dest=worker\";\n\n\t\t\t\tif (args[1] && typeof args[1] === \"string\")\n\t\t\t\t\targs[1] = `${client.url.origin}@${args[1]}`;\n\n\t\t\t\tif (args[1] && typeof args[1] === \"object\") {\n\t\t\t\t\tif (args[1].type === \"module\") {\n\t\t\t\t\t\targs[0] += \"&type=module\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args[1].name === \"name\") {\n\t\t\t\t\t\targs[1].name = `${client.url.origin}@${args[1].name}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst worker = call();\n\t\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t\t(async () => {\n\t\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\t\tsharedworkerpostmessage.call(\n\t\t\t\t\t\tworker.port,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\t\tport,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[port]\n\t\t\t\t\t);\n\t\t\t\t})();\n\t\t\t},\n\t\t});\n\t}\n}\n","import { iswindow, isworker } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\nimport { argdbg } from \"./err\";\nimport { indirectEval } from \"./eval\";\n\nexport function createWrapFn(client: ScramjetClient, self: typeof globalThis) {\n\treturn function (identifier: any, args: any) {\n\t\tif (iswindow && identifier instanceof self.Window) {\n\t\t\treturn client.globalProxy;\n\t\t} else if (iswindow && identifier instanceof self.parent.self.Window) {\n\t\t\tif (SCRAMJETCLIENT in self.parent.self) {\n\t\t\t\t// ... then we're in a subframe, and the parent frame is also in a proxy context, so we should return its proxy\n\t\t\t\treturn self.parent.self[SCRAMJETCLIENT].globalProxy;\n\t\t\t} else {\n\t\t\t\t// ... then we should pretend we aren't nested and return the current window\n\t\t\t\treturn client.globalProxy;\n\t\t\t}\n\t\t} else if (iswindow && identifier instanceof self.top.self.Window) {\n\t\t\t// instead of returning top, we need to return the uppermost parent that's inside a scramjet context\n\t\t\tlet current = self.self;\n\n\t\t\tfor (;;) {\n\t\t\t\tconst test = current.parent.self;\n\t\t\t\tif (test === current) break; // there is no parent, actual or emulated.\n\n\t\t\t\t// ... then `test` represents a window outside of the proxy context, and therefore `current` is the topmost window in the proxy context\n\t\t\t\tif (!(SCRAMJETCLIENT in test)) break;\n\n\t\t\t\t// test is also insde a proxy, so we should continue up the chain\n\t\t\t\tcurrent = test;\n\t\t\t}\n\n\t\t\treturn current[SCRAMJETCLIENT].globalProxy.window;\n\t\t} else if (\n\t\t\t(iswindow && identifier instanceof self.Location) ||\n\t\t\t(isworker && identifier instanceof self.WorkerLocation)\n\t\t) {\n\t\t\treturn client.locationProxy;\n\t\t} else if (iswindow && identifier instanceof self.Document) {\n\t\t\treturn client.documentProxy;\n\t\t} else if (isworker && identifier instanceof self.WorkerGlobalScope) {\n\t\t\treturn client.globalProxy;\n\t\t}\n\n\t\treturn identifier;\n\t};\n}\n\nexport const order = 4;\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// the main magic of the proxy. all attempts to access any \"banned objects\" will be redirected here, and instead served a proxy object\n\t// this contrasts from how other proxies will leave the root object alone and instead attempt to catch every member access\n\t// this presents some issues (see element.ts), but makes us a good bit faster at runtime!\n\tObject.defineProperty(self, config.globals.wrapfn, {\n\t\tvalue: client.wrapfn,\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\n\tself.$scramitize = function (v) {\n\t\tif (typeof v === \"string\" && v.includes(\"scramjet\")) {\n\t\t\tdebugger;\n\t\t}\n\n\t\tif (typeof v === \"string\" && v.includes(location.origin)) {\n\t\t\tdebugger;\n\t\t}\n\n\t\tif (iswindow && v instanceof Document && v.defaultView.$scramjet) {\n\t\t\tdebugger;\n\t\t}\n\n\t\treturn v;\n\t};\n\n\t// location = \"...\" can't be rewritten as wrapfn(location) = ..., so instead it will actually be rewritten as\n\t// ((t)=>$scramjet$tryset(location,\"+=\",t)||location+=t)(...);\n\t// it has to be a discrete function because there's always the possibility that \"location\" is a local variable\n\t// we have to use an IIFE to avoid duplicating side-effects in the getter\n\tObject.defineProperty(self, config.globals.trysetfn, {\n\t\tvalue: function (lhs: any, op: string, rhs: any) {\n\t\t\tif (lhs instanceof Location) {\n\t\t\t\t// @ts-ignore\n\t\t\t\tlocationProxy.href = rhs;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n","import { ScramjetClient } from \"./client\";\nimport { unrewriteUrl } from \"../shared\";\n\nexport class ScramjetServiceWorkerRuntime {\n\trecvport: MessagePort;\n\tconstructor(public client: ScramjetClient) {\n\t\t// @ts-ignore\n\t\tself.onconnect = (cevent: MessageEvent) => {\n\t\t\tconst port = cevent.ports[0];\n\t\t\tdbg.log(\"sw\", \"connected\");\n\n\t\t\tport.addEventListener(\"message\", (event) => {\n\t\t\t\tconsole.log(\"sw\", event.data);\n\t\t\t\tif (\"scramjet$type\" in event.data) {\n\t\t\t\t\tif (event.data.scramjet$type === \"init\") {\n\t\t\t\t\t\tthis.recvport = event.data.scramjet$port;\n\t\t\t\t\t\tthis.recvport.postMessage({ scramjet$type: \"init\" });\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleMessage.call(this, client, event.data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tport.start();\n\t\t};\n\t}\n\n\thook() {\n\t\tthis.client.global.registration = {\n\t\t\t// TODO IMPLEMENT SCOPES\n\t\t\tscope: this.client.url.href,\n\t\t\tactive: {\n\t\t\t\tscriptURL: this.client.url.href,\n\t\t\t\tstate: \"activated\",\n\t\t\t\tonstatechange: null,\n\t\t\t\tonerror: null,\n\n\t\t\t\tpostMessage: () => {},\n\t\t\t\taddEventListener: () => {},\n\t\t\t\tremoveEventListener: () => {},\n\t\t\t\tdispatchEvent: (_e: Event) => {},\n\t\t\t},\n\t\t\tshowNotification: async () => {},\n\t\t\tunregister: async () => true,\n\t\t\tupdate: async () => {},\n\t\t\tinstalling: null,\n\t\t\twaiting: null,\n\t\t};\n\n\t\t// @ts-ignore\n\t\tthis.client.global.ServiceWorkerGlobalScope = this.client.global;\n\t}\n}\n\nfunction handleMessage(\n\tthis: ScramjetServiceWorkerRuntime,\n\tclient: ScramjetClient,\n\tdata: MessageW2R\n) {\n\tconst port = this.recvport;\n\tconst type = data.scramjet$type;\n\tconst token = data.scramjet$token;\n\n\tif (type === \"fetch\") {\n\t\tdbg.log(\"ee\", data);\n\t\tconst fetchhandlers = client.eventcallbacks.get(self);\n\t\tif (!fetchhandlers) return;\n\n\t\tfor (const handler of fetchhandlers) {\n\t\t\tif (handler.event !== \"fetch\") continue;\n\n\t\t\tconst request = data.scramjet$request;\n\n\t\t\tconst Request = client.natives[\"Request\"];\n\t\t\tconst fakeRequest = new Request(unrewriteUrl(request.url), {\n\t\t\t\tbody: request.body,\n\t\t\t\theaders: new Headers(request.headers),\n\t\t\t\tmethod: request.method,\n\t\t\t\tmode: \"same-origin\",\n\t\t\t});\n\n\t\t\tObject.defineProperty(fakeRequest, \"destination\", {\n\t\t\t\tvalue: request.destinitation,\n\t\t\t});\n\n\t\t\t// TODO: clean up, maybe put into a class\n\t\t\tconst fakeFetchEvent: any = new Event(\"fetch\");\n\t\t\tfakeFetchEvent.request = fakeRequest;\n\t\t\tlet responded = false;\n\t\t\tfakeFetchEvent.respondWith = (response: Response | Promise<Response>) => {\n\t\t\t\tresponded = true;\n\t\t\t\t(async () => {\n\t\t\t\t\tresponse = await response;\n\t\t\t\t\tconst message: MessageR2W = {\n\t\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\t\tscramjet$response: {\n\t\t\t\t\t\t\tbody: response.body,\n\t\t\t\t\t\t\theaders: Array.from(response.headers.entries()),\n\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tdbg.log(\"sw\", \"responding\", message);\n\t\t\t\t\tport.postMessage(message, [response.body]);\n\t\t\t\t})();\n\t\t\t};\n\n\t\t\tdbg.log(\"to fn\", fakeFetchEvent);\n\t\t\thandler.proxiedCallback(trustEvent(fakeFetchEvent));\n\t\t\tif (!responded) {\n\t\t\t\tconsole.log(\"sw\", \"no response\");\n\t\t\t\tport.postMessage({\n\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\tscramjet$response: false,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction trustEvent(event: Event): Event {\n\treturn new Proxy(event, {\n\t\tget(target, prop, reciever) {\n\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\treturn Reflect.get(target, prop);\n\t\t},\n\t});\n}\n\nexport type TransferrableResponse = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tstatus: number;\n\tstatusText: string;\n};\n\nexport type TransferrableRequest = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tdestinitation: RequestDestination;\n\tmethod: Request[\"method\"];\n\tmode: Request[\"mode\"];\n\turl: string;\n};\n\ntype FetchResponseMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$response: TransferrableResponse;\n};\n\ntype FetchRequestMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$request: TransferrableRequest;\n};\n\n// r2w = runtime to (service) worker\n\ntype MessageTypeR2W = FetchResponseMessage;\ntype MessageTypeW2R = FetchRequestMessage;\n\ntype MessageCommon = {\n\tscramjet$type: string;\n\tscramjet$token: number;\n};\n\nexport type MessageR2W = MessageCommon & MessageTypeR2W;\nexport type MessageW2R = MessageCommon &\n\tMessageTypeW2R & { scramjet$port?: MessagePort };\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"importScripts\", {\n\t\tapply(ctx) {\n\t\t\tfor (const i in ctx.args) {\n\t\t\t\tctx.args[i] = rewriteUrl(ctx.args[i], client.meta);\n\t\t\t}\n\t\t},\n\t});\n}\n","export default {\n\tfmt: function (severity: string, message: string, ...args: any[]) {\n\t\tconst old = Error.prepareStackTrace;\n\n\t\tError.prepareStackTrace = (_, stack) => {\n\t\t\tstack.shift(); // stack();\n\t\t\tstack.shift(); // fmt();\n\t\t\tstack.shift();\n\n\t\t\tlet fmt = \"\";\n\t\t\tfor (let i = 1; i < Math.min(2, stack.length); i++) {\n\t\t\t\tif (stack[i].getFunctionName()) {\n\t\t\t\t\t// const f = stack[i].getThis()?.constructor?.name;\n\t\t\t\t\t// if (f) fmt += `${f}.`\n\t\t\t\t\tfmt += `${stack[i].getFunctionName()} -> ` + fmt;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfmt += stack[0].getFunctionName() || \"Anonymous\";\n\n\t\t\treturn fmt;\n\t\t};\n\n\t\tconst fmt = (function stack() {\n\t\t\ttry {\n\t\t\t\tthrow new Error();\n\t\t\t} catch (e) {\n\t\t\t\treturn e.stack;\n\t\t\t}\n\t\t})();\n\n\t\tError.prepareStackTrace = old;\n\n\t\tconst fn = console[severity] || console.log;\n\t\tconst bg = {\n\t\t\tlog: \"#000\",\n\t\t\twarn: \"#f80\",\n\t\t\terror: \"#f00\",\n\t\t\tdebug: \"transparent\",\n\t\t}[severity];\n\t\tconst fg = {\n\t\t\tlog: \"#fff\",\n\t\t\twarn: \"#fff\",\n\t\t\terror: \"#fff\",\n\t\t\tdebug: \"gray\",\n\t\t}[severity];\n\t\tconst padding = {\n\t\t\tlog: 2,\n\t\t\twarn: 4,\n\t\t\terror: 4,\n\t\t\tdebug: 0,\n\t\t}[severity];\n\n\t\tfn(\n\t\t\t`%c${fmt}%c ${message}`,\n\t\t\t`\n\t\tbackground-color: ${bg};\n\t\tcolor: ${fg};\n\t\tpadding: ${padding}px;\n\t\tfont-weight: bold;\n\t\tfont-family: monospace;\n\t\tfont-size: 0.9em;\n\t`,\n\t\t\t`${severity === \"debug\" ? \"color: gray\" : \"\"}`,\n\t\t\t...args\n\t\t);\n\t},\n\tlog: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"log\", message, ...args);\n\t},\n\twarn: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"warn\", message, ...args);\n\t},\n\terror: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"error\", message, ...args);\n\t},\n\tdebug: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"debug\", message, ...args);\n\t},\n};\n","import { ScramjetConfig, ScramjetFlags } from \"./types\";\n\nif (!(\"$scramjet\" in self)) {\n\t// @ts-expect-error ts stuff\n\tself.$scramjet = {\n\t\tversion: {\n\t\t\tbuild: COMMITHASH,\n\t\t\tversion: VERSION,\n\t\t},\n\t\tcodec: {},\n\t\tflagEnabled,\n\t};\n}\n\nexport const $scramjet = self.$scramjet;\n\nconst nativeFunction = Function;\nexport function loadCodecs() {\n\t$scramjet.codec.encode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.encode\n\t) as any;\n\t$scramjet.codec.decode = nativeFunction(\n\t\t\"url\",\n\t\t$scramjet.config.codec.decode\n\t) as any;\n}\n\nexport function flagEnabled(flag: keyof ScramjetFlags, url: URL): boolean {\n\tlet value = $scramjet.config.defaultFlags[flag];\n\tfor (const regex in $scramjet.config.siteFlags) {\n\t\tconst partialflags = $scramjet.config.siteFlags[regex];\n\t\tif (new RegExp(regex).test(url.href) && flag in partialflags) {\n\t\t\treturn partialflags[flag];\n\t\t}\n\t}\n\n\treturn value;\n}\n","import { $scramjet } from \"./scramjet\";\n\nexport const {\n\tutil: { BareClient, ScramjetHeaders, BareMuxConnection },\n\turl: { rewriteUrl, unrewriteUrl, rewriteBlob, unrewriteBlob },\n\trewrite: {\n\t\trewriteCss,\n\t\tunrewriteCss,\n\t\trewriteHtml,\n\t\tunrewriteHtml,\n\t\trewriteSrcset,\n\t\trewriteJs,\n\t\trewriteHeaders,\n\t\trewriteWorkers,\n\t\thtmlRules,\n\t},\n\tCookieStore,\n} = $scramjet.shared;\n\nexport const config = $scramjet.config;\n","// see types.d.ts for what these mean\nexport const SCRAMJETCLIENT = Symbol.for(\"scramjet client global\");\nexport const SCRAMJETFRAME = Symbol.for(\"scramjet frame handle\");\n"],"names":["ScramjetClient","createDocumentProxy","client","self","Proxy","target","prop","Reflect","newValue","location","rewriteUrl","getOwnPropertyDescriptorHandler","ctx","map","proxy","receiver","value","Object","name","namespace","NamedNodeMap","thisArg","argArray","Attr","keys","key","data","URL","cssProperties","rewriteCss","realProperty","unrewriteCss","style","t","p","v","rewriteHtml","nativeSetAttribute","attrObject","urlinterfaces","originalhrefs","nativeGetOwnPropertyDescriptor","attr","element","descriptor","unrewriteUrl","HTMLMediaElement","unrewriteBlob","rewriteSrcset","i","desc","href","url","base","ruleList","htmlRules","rule","r","newval","rewriteJs","atob","unrewriteHtml","realwin","SCRAMJETCLIENT","newclient","contentwindow","doc","scram","n","Document","_self","ev","UrlChangeEvent","f","win","realPostMessage","order","enabled","flagEnabled","disabled","_client","Navigator","registration","undefined","Promise","resolve","_ctx","console","handle","worker","fakeRegistration","ServiceWorkerRegistration","ServiceWorker","handler","index","realLocalStorage","property","attributes","localStorageProxy","sessionStorageProxy","NavigateEvent","Event","UNSAFE_GLOBALS","createGlobalProxy","iswindow","isNaN","Number","isworker","issw","isdedicated","isshared","isemulatedsw","ScramjetContextInit","dbg","loadCodecs","runtime","ScramjetServiceWorkerRuntime","document","createLocationProxy","Location","fakeLocation","descriptorSource","native","args","nativeFunction","log","rewriteBlob","argdbg","arg","recurse","Symbol","ar","e","closure","error","stack","newstack","config","lines","line","l","_value","js","indirectEval","indirection","realOnEvent","handlers","wraplistener","listener","realEvent","type","_target","reciever","unproxy","origlistener","proxylistener","arr","targets","rewriteFunction","stringifiedFunction","content","wasm","WASM_VECTOR_LEN","cachedUint8ArrayMemory0","getUint8ArrayMemory0","Uint8Array","cachedTextEncoder","TextEncoder","Error","encodeString","view","buf","passStringToWasm0","malloc","realloc","ptr","len","mem","offset","code","ret","cachedDataViewMemory0","getDataViewMemory0","DataView","cachedTextDecoder","TextDecoder","getStringFromWasm0","getArrayU8FromWasm0","handleError","idx","addToExternrefTable0","obj","__wbg_load","module","imports","Response","WebAssembly","bytes","instance","__wbg_get_imports","arg0","arg1","x","ptr1","isLikeNone","len1","arguments","arg2","arg3","deferred0_0","deferred0_1","val","window","globalThis","global","Function","table","__wbg_init_memory","memory","__wbg_finalize_init","thread_stack_size","__wbg_init","module_or_path","Request","fetch","initSync","c","resolved","meta","text","rewriteJsNaiive","$scramjet","rewrite_js","scramjet","ptr0","len0","v3","rewrite_js_from_arraybuffer","passArray8ToWasm0","prefixed","tryCanParseURL","origin","pollutant","POLLUTANT","callerClient","callerGlobalThisProxied","wrappedPostMessage","toproxy","pollution","socketmap","WeakMap","fakeWebSocket","EventTarget","trustEvent","barews","state","fakeEventSend","fakeev","CloseEvent","MessageEvent","ws","opts","nativeworker","postmessage","self1","ARGS","HEADERS","headers","sab","SharedArrayBuffer","now","performance","status","headersLength","headersab","bodyLength","bodyab","body","parser","DOMParser","header","match","re","RegExp","Worker","sourcemaps","maps","tag","scramtag_ident","stringified","newString","scramtagstart","firstspace","absindex","abstagindex","parseInt","scramtagend","j","str","start","end","getCtx","setCtx","workerpostmessage","sharedworkerpostmessage","MessagePort","call","conn","BareMuxConnection","port","createWrapFn","identifier","current","test","severity","message","old","_","fmt","Math","COMMITHASH","VERSION","flag","regex","partialflags","BareClient","ScramjetHeaders","rewriteHeaders","rewriteWorkers","CookieStore","SCRAMJETFRAME"],"mappings":"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"}